(self.webpackChunktiles=self.webpackChunktiles||[]).push([[999],{1999:(Nr,rn,ot)=>{"use strict";ot.r(rn),ot.d(rn,{MapGridModule:()=>hd});var ee=ot(6814),$=ot(9310);const Ct=class mi{constructor(t){this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},Te=class pi{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function ne(n,t){return n>t?1:n<t?-1:0}function Bt(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if("function"==typeof e){for(let r=1;r<i;++r){const s=n[r];if(s===t)return r;if(s<t)return e(t,n[r-1],s)>0?r-1:r}return i-1}if(e>0){for(let r=1;r<i;++r)if(n[r]<t)return r-1;return i-1}if(e<0){for(let r=1;r<i;++r)if(n[r]<=t)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==t)return r;if(n[r]<t)return n[r-1]-t<t-n[r]?r-1:r}return i-1}function T(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function M(){return!0}function P(){return!1}function G(){}function J(n){for(const t in n)delete n[t]}function V(n){let t;for(t in n)return!1;return!t}const qt=class st extends Te{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=e?new Ct(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let l;i in o||(o[i]=0,a[i]=0),++o[i];for(let h=0,c=r.length;h<c;++h)if(l="handleEvent"in r[h]?r[h].handleEvent(s):r[h].call(this,s),!1===l||s.propagationStopped){l=!1;break}if(0==--o[i]){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,G);delete o[i]}return l}disposeInternal(){this.listeners_&&J(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);-1!==r&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=G,++this.pendingRemovals_[t]):(i.splice(r,1),0===i.length&&delete this.listeners_[t]))}};function Y(n,t,e,i,r){if(i&&i!==n&&(e=e.bind(i)),r){const o=e;e=function(){n.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:n,type:t,listener:e};return n.addEventListener(t,e),s}function Gt(n,t,e,i){return Y(n,t,e,i,!0)}function et(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),J(n))}const Tt=class ie extends qt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent("change")}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Y(this,t[s],e);return r}return Y(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=Gt(this,t[s],e)}else i=Gt(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function Re(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)et(n[t]);else et(n)}(i);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};function K(){throw new Error("Unimplemented abstract method.")}let ea=0;function vt(n){return n.ol_uid||(n.ol_uid=String(++ea))}class kr extends Ct{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const re=class na extends Tt{constructor(t){super(),vt(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new kr(i,t,e)),i="propertychange",this.hasListener(i)&&this.dispatchEvent(new kr(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],V(this.values_)&&(this.values_=null),e||this.notify(t,i)}}};class Dn extends Ct{constructor(t,e,i){super(t),this.element=e,this.index=i}}const se=class ia extends re{constructor(t,e){if(super(),this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get("length")}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Dn("add",e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Dn("remove",e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Dn("remove",r,t)),this.dispatchEvent(new Dn("add",e,t))}updateLength_(){this.set("length",this.array_.length)}assertUnique_(t,e){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}};function H(n,t){if(!n)throw new Error(t)}function at(n,t,e){return Math.min(Math.max(n,t),e)}function ra(n,t,e,i,r,s){const o=r-e,a=s-i;if(0!==o||0!==a){const l=((n-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=r,i=s):l>0&&(e+=o*l,i+=a*l)}return ze(n,t,e,i)}function ze(n,t,e,i){const r=e-n,s=i-t;return r*r+s*s}function Fn(n){return n*Math.PI/180}function Ie(n,t){const e=n%t;return e*t<0?e+t:e}function oa(n,t,e){return n+e*(t-n)}function Ei(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function Nn(n,t){return Math.floor(Ei(n,t))}function kn(n,t){return Math.ceil(Ei(n,t))}const Gr=class aa extends re{constructor(t){super(),this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,H("number"==typeof e.opacity,"Layer opacity must be a number"),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=at(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return K()}getLayerStatesArray(t){return K()}getExtent(){return this.get("extent")}getMaxResolution(){return this.get("maxResolution")}getMinResolution(){return this.get("minResolution")}getMinZoom(){return this.get("minZoom")}getMaxZoom(){return this.get("maxZoom")}getOpacity(){return this.get("opacity")}getSourceState(){return K()}getVisible(){return this.get("visible")}getZIndex(){return this.get("zIndex")}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set("extent",t)}setMaxResolution(t){this.set("maxResolution",t)}setMinResolution(t){this.set("minResolution",t)}setMaxZoom(t){this.set("maxZoom",t)}setMinZoom(t){this.set("minZoom",t)}setOpacity(t){H("number"==typeof t,"Layer opacity must be a number"),this.set("opacity",t)}setVisible(t){this.set("visible",t)}setZIndex(t){this.set("zIndex",t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},Xt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},la=42,vi=256,an={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},Xr=class ca{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||an[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},ln=6378137,Ge=Math.PI*ln,ua=[-Ge,-Ge,Ge,Ge],da=[-180,-85,180,85],zn=ln*Math.log(Math.tan(Math.PI/2));class Xe extends Xr{constructor(t){super({code:t,units:"m",extent:ua,global:!0,worldExtent:da,getPointResolution:function(e,i){return e/Math.cosh(i[1]/ln)}})}}const Yr=[new Xe("EPSG:3857"),new Xe("EPSG:102100"),new Xe("EPSG:102113"),new Xe("EPSG:900913"),new Xe("http://www.opengis.net/def/crs/EPSG/0/3857"),new Xe("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fa(n,t,e){const i=n.length;e=e>1?e:2,void 0===t&&(t=e>2?n.slice():new Array(i));for(let r=0;r<i;r+=e){t[r]=Ge*n[r]/180;let s=ln*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));s>zn?s=zn:s<-zn&&(s=-zn),t[r+1]=s}return t}function ga(n,t,e){const i=n.length;e=e>1?e:2,void 0===t&&(t=e>2?n.slice():new Array(i));for(let r=0;r<i;r+=e)t[r]=180*n[r]/Ge,t[r+1]=360*Math.atan(Math.exp(n[r+1]/ln))/Math.PI-90;return t}const Zr=[-180,-90,180,90],ma=6378137*Math.PI/180;class Me extends Xr{constructor(t,e){super({code:t,units:"degrees",extent:Zr,axisOrientation:e,global:!0,metersPerUnit:ma,worldExtent:Zr})}}const Ur=[new Me("CRS:84"),new Me("EPSG:4326","neu"),new Me("urn:ogc:def:crs:OGC:1.3:CRS84"),new Me("urn:ogc:def:crs:OGC:2:84"),new Me("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Me("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Me("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Gn={},Yt={};function Xn(n,t,e){const i=n.getCode(),r=t.getCode();i in Yt||(Yt[i]={}),Yt[i][r]=e}const ht={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function jr(n){const t=[1/0,1/0,-1/0,-1/0];for(let e=0,i=n.length;e<i;++e)hn(t,n[e]);return t}function Wr(n,t,e){let i,r;return i=t<n[0]?n[0]-t:n[2]<t?t-n[2]:0,r=e<n[1]?n[1]-e:n[3]<e?e-n[3]:0,i*i+r*r}function wi(n,t){return Kr(n,t[0],t[1])}function Kr(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function Vr(n,t){const o=t[0],a=t[1];let l=ht.UNKNOWN;return o<n[0]?l|=ht.LEFT:o>n[2]&&(l|=ht.RIGHT),a<n[1]?l|=ht.BELOW:a>n[3]&&(l|=ht.ABOVE),l===ht.UNKNOWN&&(l=ht.INTERSECTING),l}function Ye(n,t,e,i,r){return r?(r[0]=n,r[1]=t,r[2]=e,r[3]=i,r):[n,t,e,i]}function Ae(n){return Ye(1/0,1/0,-1/0,-1/0,n)}function Ci(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function hn(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function qr(n,t,e,i,r){for(;e<i;e+=r)xa(n,t[e],t[e+1]);return n}function xa(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function Hr(n,t){let e;return e=t(Zn(n)),!!(e||(e=t(Un(n)),e)||(e=t(jn(n)),e)||(e=t(be(n)),e))&&e}function Yn(n){let t=0;return un(n)||(t=Q(n)*Rt(n)),t}function Zn(n){return[n[0],n[1]]}function Un(n){return[n[2],n[1]]}function Ze(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Aa(n,t){let e;if("bottom-left"===t)e=Zn(n);else if("bottom-right"===t)e=Un(n);else if("top-left"===t)e=be(n);else{if("top-right"!==t)throw new Error("Invalid corner");e=jn(n)}return e}function Ti(n,t,e,i,r){const[s,o,a,l,h,c,u,d]=Ri(n,t,e,i);return Ye(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function Ri(n,t,e,i){const r=t*i[0]/2,s=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,c=s*o,u=s*a,d=n[0],f=n[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function Rt(n){return n[3]-n[1]}function Ue(n,t,e){const i=e||[1/0,1/0,-1/0,-1/0];return cn(n,t)?(i[0]=n[0]>t[0]?n[0]:t[0],i[1]=n[1]>t[1]?n[1]:t[1],i[2]=n[2]<t[2]?n[2]:t[2],i[3]=n[3]<t[3]?n[3]:t[3]):Ae(i),i}function be(n){return[n[0],n[3]]}function jn(n){return[n[2],n[3]]}function Q(n){return n[2]-n[0]}function cn(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function un(n){return n[2]<n[0]||n[3]<n[1]}function Wn(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function Ii(n,t){const e=Math.cos(t),i=Math.sin(t),s=n[1]*e+n[0]*i;return n[0]=n[0]*e-n[1]*i,n[1]=s,n}const Kn=6371008.8;function Mi(n,t,e){e=e||Kn;const i=Fn(n[1]),r=Fn(t[1]),s=(r-i)/2,o=Fn(t[0]-n[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const dn={info:1,warn:2,error:3,none:4};let Bn=dn.info;function Qr(...n){Bn>dn.warn||console.warn(...n)}let Ai=!0;function ts(n){Ai=!(void 0===n||n)}function bi(n,t){if(void 0!==t)for(let e=0,i=n.length;e<i;++e)t[e]=n[e];else t=n.slice();return t}function es(n,t){if(void 0!==t&&n!==t){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];n=t}return n}function Ua(n){(function ya(n,t){Gn[n]=t})(n.getCode(),n),Xn(n,n,bi)}function ft(n){return"string"==typeof n?function pa(n){return Gn[n]||Gn[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}(n):n||null}function ns(n,t,e,i){let r;const s=(n=ft(n)).getPointResolutionFunc();if(s){if(r=s(t,e),i&&i!==n.getUnits()){const o=n.getMetersPerUnit();o&&(r=r*o/an[i])}}else{const o=n.getUnits();if("degrees"==o&&!i||"degrees"==i)r=t;else{const a=Hn(n,ft("EPSG:4326"));if(a===es&&"degrees"!==o)r=t*n.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2),r=(Mi(h.slice(0,2),h.slice(2,4))+Mi(h.slice(4,6),h.slice(6,8)))/2}const l=i?an[i]:n.getMetersPerUnit();void 0!==l&&(r/=l)}}return r}function is(n){(function ja(n){n.forEach(Ua)})(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Xn(t,e,bi)})})}function Li(n,t){return n?"string"==typeof n?ft(n):n:ft(t)}function qn(n,t){return ts(),gn(n,"EPSG:4326",void 0!==t?t:"EPSG:3857")}function ss(n,t){const e=gn(n,void 0!==t?t:"EPSG:3857","EPSG:4326"),i=e[0];return(i<-180||i>180)&&(e[0]=Ie(i+180,360)-180),e}function je(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||Hn(n,t)===bi)&&e}function Hn(n,t){let r=function Ea(n,t){let e;return n in Yt&&t in Yt[n]&&(e=Yt[n][t]),e}(n.getCode(),t.getCode());return r||(r=es),r}function fn(n,t){return Hn(ft(n),ft(t))}function gn(n,t,e){return fn(t,e)(n,void 0,n.length)}let wt=null;function Pi(n,t){return n}function oe(n,t){return Ai&&!Wn(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Ai=!1,Qr("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function We(n,t){return n}function as(n,t,e){return function(i,r,s,o,a){if(!i)return;if(!r&&!t)return i;const l=t?0:s[0]*r,h=t?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=n[0]+l/2+c,f=n[2]-l/2+c,g=n[1]+h/2+u,p=n[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>p&&(g=(p+g)/2,p=g);let v=at(i[0],d,f),C=at(i[1],g,p);if(o&&e&&r){const w=30*r;v+=-w*Math.log(1+Math.max(0,d-i[0])/w)+w*Math.log(1+Math.max(0,i[0]-f)/w),C+=-w*Math.log(1+Math.max(0,g-i[1])/w)+w*Math.log(1+Math.max(0,i[1]-p)/w)}return[v,C]}}function Ha(n){return n}function Si(n,t,e,i){const r=Q(t)/e[0],s=Rt(t)/e[1];return i?Math.min(n,Math.max(r,s)):Math.min(n,Math.min(r,s))}function Oi(n,t,e){let i=Math.min(n,t);return i*=Math.log(1+50*Math.max(0,n/t-1))/50+1,e&&(i=Math.max(i,e),i/=Math.log(1+50*Math.max(0,e/n-1))/50+1),at(i,e/2,2*t)}function ls(n,t,e,i,r){return e=void 0===e||e,function(s,o,a,l){if(void 0!==s){const h=i?Si(n,i,a,r):n;return e&&l?Oi(s,h,t):at(s,t,h)}}}function Di(n){if(void 0!==n)return 0}function hs(n){if(void 0!==n)return n}function cs(n){return Math.pow(n,3)}function Ke(n){return 1-cs(1-n)}function Fi(n){return 3*n*n-2*n*n*n}function el(n){return n}function Ot(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function Ve(n,t,e,i,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return n[0]=i*h,n[1]=r*l,n[2]=-i*l,n[3]=r*h,n[4]=o*i*h-a*i*l+t,n[5]=o*r*l+a*r*h+e,n}function zi(n,t){const e=function nl(n){return n[0]*n[3]-n[1]*n[2]}(t);H(0!==e,"Transformation matrix cannot be inverted");const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return n[0]=o/e,n[1]=-r/e,n[2]=-s/e,n[3]=i/e,n[4]=(s*l-o*a)/e,n[5]=-(i*l-r*a)/e,n}!function qa(){is(Yr),is(Ur),function Wa(n,t,e,i){n.forEach(function(r){t.forEach(function(s){Xn(r,s,e),Xn(s,r,i)})})}(Ur,Yr,fa,ga)}(),new Array(6);const us=[1e6,1e6,1e6,1e6,2,2];const fs=[1,0,0,1,0,0],ll=class al extends re{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function U(n){let e,i,r,t=!1;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==r||!T(s,i))&&(t=!0,r=this,i=s,e=n.apply(this,arguments)),e}}((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return K()}closestPointXY(t,e,i,r){return K()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return K()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ae(e),this.extentRevision_=this.getRevision()}return function ba(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}(this.extent_,t)}rotate(t,e){K()}scale(t,e,i){K()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return K()}getType(){return K()}applyTransform(t){K()}intersectsExtent(t){return K()}translate(t,e){K()}transform(t,e){const i=ft(t),r="tile-pixels"==i.getUnits()?function(s,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=Rt(h)/Rt(l);return Ve(fs,h[0],h[3],c,-c,0,0,0),function il(n,t,e,i,r,s){s=s||[];let o=0;for(let a=t;a<e;a+=i){const l=n[a],h=n[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}s&&s.length!=o&&(s.length=o)}(s,0,s.length,a,fs,o),fn(i,e)(s,o,a)}:fn(i,e);return this.applyTransform(r),this}};function gs(n){let t;return"XY"==n?t=2:"XYZ"==n||"XYM"==n?t=3:"XYZM"==n&&(t=4),t}const Gi=class hl extends ll{constructor(){super(),this.layout="XY",this.stride=2}computeExtent(t){return function Ra(n,t,e,i,r){return qr(Ae(r),n,t,e,i)}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return K()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=gs(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){K()}setLayout(t,e,i){let r;if(t)r=gs(t);else{for(let s=0;s<i;++s){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}r=e.length,t=function cl(n){let t;return 2==n?t="XY":3==n?t="XYZ":4==n&&(t="XYZM"),t}(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();(function rl(n,t,e,i,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=t;d<e;d+=i){const f=n[d]-h,g=n[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let p=d+2;p<d+i;++p)o[u++]=n[p]}o&&o.length!=u&&(o.length=u)})(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=Ze(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();(function sl(n,t,e,i,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=i){const f=n[u+1]-h;a[c++]=l+r*(n[u]-l),a[c++]=h+s*f;for(let g=u+2;g<u+i;++g)a[c++]=n[g]}a&&a.length!=c&&(a.length=c)})(r,0,r.length,s,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();(function ol(n,t,e,i,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=n[l]+r,o[a++]=n[l+1]+s;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}o&&o.length!=a&&(o.length=a)})(i,0,i.length,r,t,e,i),this.changed()}}};function _s(n,t,e,i,r,s,o){const a=n[t],l=n[t+1],h=n[e]-a,c=n[e+1]-l;let u;if(0===h&&0===c)u=t;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=e;else{if(d>0){for(let f=0;f<i;++f)o[f]=oa(n[t+f],n[e+f],d);return void(o.length=i)}u=t}}for(let d=0;d<i;++d)o[d]=n[u+d];o.length=i}function ms(n,t,e,i,r){let s=n[t],o=n[t+1];for(t+=i;t<e;t+=i){const a=n[t],l=n[t+1],h=ze(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function ys(n,t,e,i,r,s,o,a,l,h,c){if(t==e)return h;let u,d;if(0===r){if(d=ze(o,a,n[t],n[t+1]),d<h){for(u=0;u<i;++u)l[u]=n[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=t+i;for(;f<e;)if(_s(n,f-i,f,i,o,a,c),d=ze(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(_s(n,e-i,t,i,o,a,c),d=ze(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function vs(n,t,e,i){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<i;++a)n[t++]=o[a]}return t}function Be(n,t){return t*Math.round(n/t)}function gl(n,t,e,i,r,s,o){if(t==e)return o;let h,c,a=Be(n[t],r),l=Be(n[t+1],r);t+=i,s[o++]=a,s[o++]=l;do{if(h=Be(n[t],r),c=Be(n[t+1],r),(t+=i)==e)return s[o++]=h,s[o++]=c,o}while(h==a&&c==l);for(;t<e;){const u=Be(n[t],r),d=Be(n[t+1],r);if(t+=i,u==h&&d==c)continue;const f=h-a,g=c-l,p=u-a,v=d-l;f*v==g*p&&(f<0&&p<f||f==p||f>0&&p>f)&&(g<0&&v<g||g==v||g>0&&v>g)?(h=u,c=d):(s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d)}return s[o++]=h,s[o++]=c,o}function Ts(n,t,e,i,r){r=void 0!==r?r:[];let s=0;for(let o=t;o<e;o+=i)r[s++]=n.slice(o,o+i);return r.length=s,r}function Is(n,t,e,i){let r=0,s=n[e-i],o=n[e-i+1];for(;t<e;t+=i){const a=n[t],l=n[t+1];r+=o*a-s*l,s=a,o=l}return r/2}class $n extends Gi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new $n(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,r){return r<Wr(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ms(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ys(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))}getArea(){return Is(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=function Xi(n,t,e,i,r,s,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)s[o++]=n[t],s[o++]=n[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=n[d],p=n[d+1],v=n[u],C=n[u+1];for(let w=d+i;w<u;w+=i){const R=ra(n[w],n[w+1],g,p,v,C);R>f&&(c=w,f=R)}f>r&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=n[t+u*i],s[o++]=n[t+u*i+1]);return o}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new $n(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vs(this.flatCoordinates,0,t,this.stride),this.changed()}}const xs=$n;class Yi extends Gi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Yi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const s=this.flatCoordinates,o=ze(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return function Ta(n,t){const e=n[0],i=n[1];return Ye(e,i,e,i,t)}(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Kr(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function ul(n,t,e,i){for(let r=0,s=e.length;r<s;++r)n[t++]=e[r];return t}(this.flatCoordinates,0,t),this.changed()}}const _l=Yi;function ml(n,t,e,i,r){return!Hr(r,function(o){return!Pe(n,t,e,i,o[0],o[1])})}function Pe(n,t,e,i,r,s){let o=0,a=n[e-i],l=n[e-i+1];for(;t<e;t+=i){const h=n[t],c=n[t+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return 0!==o}function Zi(n,t,e,i,r,s){if(0===e.length||!Pe(n,t,e[0],i,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Pe(n,e[o-1],e[o],i,r,s))return!1;return!0}function Ui(n,t,e,i,r){const s=qr([1/0,1/0,-1/0,-1/0],n,t,e,i);return!!cn(r,s)&&(!!(function Ca(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3])||function pl(n,t,e,i,r){let s;for(t+=i;t<e;t+=i)if(s=r(n.slice(t-i,t),n.slice(t,t+i)),s)return s;return!1}(n,t,e,i,function(o,a){return function La(n,t,e){let i=!1;const r=Vr(n,t),s=Vr(n,e);if(r===ht.INTERSECTING||s===ht.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],d=e[0],f=e[1],g=(f-t[1])/(d-t[0]);let p,v;s&ht.ABOVE&&!(r&ht.ABOVE)&&(p=d-(f-h)/g,i=p>=o&&p<=l),!i&&s&ht.RIGHT&&!(r&ht.RIGHT)&&(v=f-(d-l)*g,i=v>=a&&v<=h),!i&&s&ht.BELOW&&!(r&ht.BELOW)&&(p=d-(f-a)/g,i=p>=o&&p<=l),!i&&s&ht.LEFT&&!(r&ht.LEFT)&&(v=f-(d-o)*g,i=v>=a&&v<=h)}return i}(r,o,a)}))}function bs(n,t,e,i,r){return!!(Ui(n,t,e,i,r)||Pe(n,t,e,i,r[0],r[1])||Pe(n,t,e,i,r[0],r[3])||Pe(n,t,e,i,r[2],r[1])||Pe(n,t,e,i,r[2],r[3]))}function yl(n,t,e,i){for(;t<e-i;){for(let r=0;r<i;++r){const s=n[t+r];n[t+r]=n[e-i+r],n[e-i+r]=s}t+=i,e-=i}}function ji(n,t,e,i){let r=0,s=n[e-i],o=n[e-i+1];for(;t<e;t+=i){const a=n[t],l=n[t+1];r+=(a-s)*(l+o),s=a,o=l}return 0===r?void 0:r>0}function Wi(n,t,e,i,r){r=void 0!==r&&r;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ji(n,t,a,i);(0===s?r&&l||!r&&!l:r&&!l||!r&&l)&&yl(n,t,a,i),t=a}return t}class Se extends Gi{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?function _(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let r=0;r<i;r++)n[n.length]=e[r]}(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Se(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Wr(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function ps(n,t,e,i,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=ms(n,t,a,i,r),t=a}return r}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function Es(n,t,e,i,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=ys(n,t,f,i,r,s,o,a,l,h,c),t=f}return h}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return Zi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return function Ms(n,t,e,i){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Is(n,t,a,i),t=a}return r}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Wi(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,function Rs(n,t,e,i,r){r=void 0!==r?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=Ts(n,t,l,i,r[s]),t=l}return r.length=s,r}(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ze(this.getExtent());this.flatInteriorPoint_=function As(n,t,e,i,r,s,o){let a,l,h,c,u,d,f;const g=r[s+1],p=[];for(let w=0,A=e.length;w<A;++w){const I=e[w];for(c=n[I-i],d=n[I-i+1],a=t;a<I;a+=i)u=n[a],f=n[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,p.push(h)),c=u,d=f}let v=NaN,C=-1/0;for(p.sort(ne),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const w=Math.abs(u-c);w>C&&(h=(c+u)/2,Zi(n,t,e,i,h,g)&&(v=h,C=w)),c=u}return isNaN(v)&&(v=r[s]),o?(o.push(v,g,C),o):[v,g,C]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new _l(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new xs(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new xs(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function Ps(n,t,e,i,r){r=void 0!==r&&r;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ji(n,t,a,i);if(0===s){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Wi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function Cs(n,t,e,i,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=gl(n,t,c,i,r,s,o),a.push(o),t=c}return o}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Se(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return function Ls(n,t,e,i,r){if(!bs(n,t,e[0],i,r))return!1;if(1===e.length)return!0;for(let s=1,o=e.length;s<o;++s)if(ml(n,e[s-1],e[s],i,r)&&!Ui(n,e[s-1],e[s],i,r))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=function ws(n,t,e,i,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=vs(n,t,e[o],i);r[s++]=l,t=l}return r.length=s,r}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const El=Se;function Ss(n){if(un(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],r=n[3],s=[t,e,t,r,i,r,i,e,t,e];return new Se(s,"XY",[s.length])}function Jn(n,t){setTimeout(function(){n(t)},0)}function Vi(n,t,e,i,r){const s=Math.cos(-r);let o=Math.sin(-r),a=n[0]*s-n[1]*o,l=n[1]*s+n[0]*o;return a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o,[a*s-l*o,l*s+a*o]}const Zt=class wl extends re{constructor(t){super(),t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.projection_=Li(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.nextCenter_=null,this.cancelAnchor_=void 0,t.projection&&ts(),t.center&&(t.center=oe(t.center)),t.extent&&(t.extent=We(t.extent)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Xt)delete e[a];this.setProperties(e,!0);const i=function Tl(n){let t,e,i,o=void 0!==n.minZoom?n.minZoom:0,a=void 0!==n.maxZoom?n.maxZoom:28;const l=void 0!==n.zoomFactor?n.zoomFactor:2,h=void 0!==n.multiWorld&&n.multiWorld,c=void 0===n.smoothResolutionConstraint||n.smoothResolutionConstraint,u=void 0!==n.showFullExtent&&n.showFullExtent,d=Li(n.projection,"EPSG:3857"),f=d.getExtent();let g=n.constrainOnlyCenter,p=n.extent;if(!h&&!p&&d.isGlobal()&&(g=!1,p=f),void 0!==n.resolutions){const v=n.resolutions;e=v[o],i=void 0!==v[a]?v[a]:v[v.length-1],t=n.constrainResolution?function $a(n,t,e,i){return t=void 0===t||t,function(r,s,o,a){if(void 0!==r){const l=n[0],h=n[n.length-1],c=e?Si(l,e,o,i):l;if(a)return t?Oi(r,c,h):at(r,h,c);const u=Math.min(c,r),d=Math.floor(Bt(n,u,s));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}(v,c,!g&&p,u):ls(e,i,c,!g&&p,u)}else{const C=(f?Math.max(Q(f),Rt(f)):360*an.degrees/d.getMetersPerUnit())/vi/Math.pow(2,0),w=C/Math.pow(2,28);e=n.maxResolution,void 0!==e?o=0:e=C/Math.pow(l,o),i=n.minResolution,void 0===i&&(i=void 0!==n.maxZoom?void 0!==n.maxResolution?e/Math.pow(l,a):C/Math.pow(l,a):w),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),t=n.constrainResolution?function Ja(n,t,e,i,r,s){return i=void 0===i||i,e=void 0!==e?e:0,function(o,a,l,h){if(void 0!==o){const c=r?Si(t,r,l,s):t;if(h)return i?Oi(o,c,e):at(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(n)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),p=Math.floor(Math.log(t/g)/Math.log(n)+f),v=Math.max(d,p);return at(t/Math.pow(n,v),e,c)}}}(l,e,i,c,!g&&p,u):ls(e,i,c,!g&&p,u)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const r=function Cl(n){if(void 0!==n.extent)return as(n.extent,n.constrainOnlyCenter,void 0===n.smoothExtentConstraint||n.smoothExtentConstraint);const t=Li(n.projection,"EPSG:3857");if(!0!==n.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,as(e,!1,!1)}return Ha}(t),s=i.constraint,o=function Rl(n){if(void 0===n.enableRotation||n.enableRotation){const e=n.constrainRotation;return void 0===e||!0===e?function tl(n){const t=void 0===n?Fn(5):n;return function(e,i){return i||void 0===e?e:Math.abs(e)<=t?0:e}}():!1===e?hs:"number"==typeof e?function Qa(n){const t=2*Math.PI/n;return function(e,i){return i?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(e):hs}return Di}(t);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const r=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution();this.setCenterInternal([i[0]+s/2*(r[3]-e[3]+e[1]-r[1]),i[1]-s/2*(r[0]-e[0]+e[2]-r[2])])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=oe(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=oe(r.anchor,this.getProjection())),e[i]=r}this.animateInternal.apply(this,e)}animateInternal(t){let i,e=arguments.length;e>1&&"function"==typeof arguments[e-1]&&(i=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),void 0!==c.zoom?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),void 0!==c.rotation&&this.setRotation(c.rotation)}if(r===e)return void(i&&Jn(i,!0));let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||Fi,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),void 0!==c.zoom?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),void 0!==c.rotation){u.sourceRotation=l;const d=Ie(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}(n=u).sourceCenter&&n.targetCenter&&!Wn(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation?s+=u.duration:u.complete=!0,h.push(u)}var n;this.animations_.push(h),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const r=this.animations_[e];if(r[0].callback&&Jn(r[0].callback,!1),!t)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;let c=l.duration>0?(t-l.start)/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter,this.targetCenter_=[d+u*(g-d),f+u*(p-f)]}if(l.sourceResolution&&l.targetResolution){const d=1===u?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){const d=1===u?Ie(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Jn(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const r=this.getCenterInternal();return void 0!==r&&(i=[r[0]-e[0],r[1]-e[1]],Ii(i,t-this.getRotation()),function Da(n,t){n[0]+=+t[0],n[1]+=+t[1]}(i,e)),i}calculateCenterZoom(t,e){let i;const r=this.getCenterInternal(),s=this.getResolution();return void 0!==r&&void 0!==s&&(i=[e[0]-t*(e[0]-r[0])/s,e[1]-t*(e[1]-r[1])/s]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],r=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Pi(t,this.getProjection())}getCenterInternal(){return this.get(Xt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return function Ba(n,t){return n}(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();H(e,"The view center is not defined");const i=this.getResolution();H(void 0!==i,"The view resolution is not defined");const r=this.getRotation();return H(void 0!==r,"The view rotation is not defined"),Ti(e,i,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Xt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(We(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Q(t)/e[0],r=Rt(t)/e[1];return Math.max(i,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),r=Math.log(e/this.minResolution_)/Math.log(t);return function(s){return e/Math.pow(t,s*r)}}getRotation(){return this.get(Xt.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=Math.log(i/this.minResolution_)/e;return function(o){return Math.log(i/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=Vi(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,i)}return{center:r.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let i,r,e=this.minZoom_||0;if(this.resolutions_){const s=Bt(this.resolutions_,t,1);e=s,i=this.resolutions_[s],r=s==this.resolutions_.length-1?2:i/this.resolutions_[s+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=at(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],at(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(H(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,"Invalid extent or geometry provided as `geometry`"),Array.isArray(t))H(!un(t),"Cannot fit empty extent provided as `geometry`"),i=Ss(We(t,this.getProjection()));else if("Circle"===t.getType()){const r=We(t.getExtent(),this.getProjection());i=Ss(r),i.rotate(this.getRotation(),Ze(r))}else{const r=function Va(){return wt}();i=r?t.clone().transform(r,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),r=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const f=s[u]*i-s[u+1]*r,g=s[u]*r+s[u+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const r=void 0!==e.padding?e.padding:[0,0,0,0],s=void 0!==e.nearest&&e.nearest;let o;o=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Ze(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const p=this.getConstrainedCenter([d[0]*u-d[1]*c,d[1]*u+d[0]*c],l),v=e.callback?e.callback:G;void 0!==e.duration?this.animateInternal({resolution:l,center:p,duration:e.duration,easing:e.easing},v):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),Jn(v,!0))}centerOn(t,e,i){this.centerOnInternal(oe(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Vi(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,r){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=Vi(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,i);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Pi(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&oe(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,r,i);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=oe(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&oe(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Xt.ROTATION)!==r&&this.set(Xt.ROTATION,r),this.get(Xt.RESOLUTION)!==o&&(this.set(Xt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Xt.CENTER)||!Wn(this.get(Xt.CENTER),a))&&this.set(Xt.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const r=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Wn(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:Ke,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&oe(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}};function Bi(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}const Qn=class Ml extends Gr{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener("source",this.handleSourcePropertyChange_),this.setSource(t.source?t.source:null)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get("source")||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!this.sourceReady_&&"ready"===this.getSource().getState()&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(et(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=Y(t,"change",this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}isVisible(t){let e;const i=this.getMapInternal();let r;!t&&i&&(t=i.getView()),e=t instanceof Zt?{viewState:t.getState(),extent:t.calculateExtent()}:t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray()),r=e.layerStatesArray?e.layerStatesArray.find(o=>o.layer===this):this.getLayerState();const s=this.getExtent();return Bi(r,e.viewState)&&(!s||cn(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];let s=e(t instanceof Zt?t.getViewStateAndExtent():t);return Array.isArray(s)||(s=[s]),s}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(et(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(et(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Y(t,"precompose",function(e){const r=e.frameState.layerStatesArray,s=this.getLayerState(!1);H(!r.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=Y(this,"change",t.render,t),this.changed())}setSource(t){this.set("source",t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};var xl=ot(1414);const Z_IDLE=0,Z_LOADING=1,Z_LOADED=2,Z_ERROR=3;function Os(n){return n[0]>0&&n[1]>0}function xt(n,t){return Array.isArray(n)?n:(void 0===t?t=[n,n]:(t[0]=n,t[1]=n),t)}class qi{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=xt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new qi({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return K()}getImage(t){return K()}getHitDetectionImage(){return K()}getPixelRatio(t){return 1}getImageState(){return K()}getImageSize(){return K()}getOrigin(){return K()}getSize(){return K()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xt(t)}listenImageChange(t){K()}load(){K()}unlistenImageChange(t){K()}ready(){return Promise.resolve()}}const Ds=qi,mn={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Oe={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};Oe.max=Oe.whitepoint[2].D65,Oe.rgb=function(n,t){var s,o,a,e=n[0]/(t=t||Oe.whitepoint[2].E)[0],i=n[1]/t[1],r=n[2]/t[2];return o=-.96924363628087*e+1.87596750150772*i+.041555057407175*r,a=.055630079696993*e+-.20397695888897*i+1.056971514242878*r,s=(s=3.240969941904521*e+-1.537383177570093*i+-.498610760293*r)>.0031308?1.055*Math.pow(s,1/2.4)-.055:s*=12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o*=12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a*=12.92,[255*(s=Math.min(Math.max(0,s),1)),255*(o=Math.min(Math.max(0,o),1)),255*(a=Math.min(Math.max(0,a),1))]},mn.xyz=function(n,t){var e=n[0]/255,i=n[1]/255,r=n[2]/255;return[(.41239079926595*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.35758433938387*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.18048078840183*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92))*(t=t||Oe.whitepoint[2].E)[0],(.21263900587151*e+.71516867876775*i+.072192315360733*r)*t[1],(.019330818715591*e+.11919477979462*i+.95053215224966*r)*t[2]]};const Ut=Oe,Hi={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,t,e){var i,r,s,h,u,d,f;return 0===(s=n[0])?[0,0,0]:(i=n[1]/(13*s)+4*(u=Ut.whitepoint[e=e||2][t=t||"D65"][0])/(u+15*(d=Ut.whitepoint[e][t][1])+3*(f=Ut.whitepoint[e][t][2]))||0,r=n[2]/(13*s)+9*d/(u+15*d+3*f)||0,[9*(h=s>8?d*Math.pow((s+16)/116,3):d*s*.0011070564598794539)*i/(4*r)||0,h,h*(12-3*i-20*r)/(4*r)||0])}};Ut.luv=function(n,t,e){var i,r,s,l,h,c,u,d,f,g,p;g=4*(u=Ut.whitepoint[e=e||2][t=t||"D65"][0])/(u+15*(d=Ut.whitepoint[e][t][1])+3*(f=Ut.whitepoint[e][t][2])),p=9*d/(u+15*d+3*f),i=4*(l=n[0])/(l+15*(h=n[1])+3*(c=n[2]))||0,r=9*h/(l+15*h+3*c)||0;var w=h/d;return[s=w<=.008856451679035631?903.2962962962961*w:116*Math.pow(w,1/3)-16,13*s*(i-g),13*s*(r-p)]};var Fs={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(n){var o,e=n[1];return o=n[2]/360*2*Math.PI,[n[0],e*Math.cos(o),e*Math.sin(o)]},xyz:function(n){return Hi.xyz(Fs.luv(n))}};const bl=Fs;Hi.lchuv=function(n){var t=n[0],e=n[1],i=n[2],r=Math.sqrt(e*e+i*i),o=360*Math.atan2(i,e)/2/Math.PI;return o<0&&(o+=360),[t,r,o]},Ut.lchuv=function(n){return Hi.lchuv(Ut.luv(n))};const Ns={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ll=function Pl(n){var t,r,e=[],i=1;if("number"==typeof n)return{space:"rgb",values:[n>>>16,(65280&n)>>>8,255&n],alpha:1};if("number"==typeof n)return{space:"rgb",values:[n>>>16,(65280&n)>>>8,255&n],alpha:1};if(n=String(n).toLowerCase(),Ns[n])e=Ns[n].slice(),r="rgb";else if("transparent"===n)i=0,r="rgb",e=[0,0,0];else if("#"===n[0]){var s=n.slice(1),o=s.length;i=1,o<=4?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],4===o&&(i=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],8===o&&(i=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var h="cmyk"===(r=t[1].replace(/a$/,""))?4:"gray"===r?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),"color"===r&&(r=e.shift()),i=(e=e.map(function(c,u){if("%"===c[c.length-1])return c=parseFloat(c)/100,3===u?c:"rgb"===r?255*c:"h"===r[0]||"l"===r[0]&&!u?100*c:"lab"===r?125*c:"lch"===r?u<2?150*c:360*c:"o"!==r[0]||u?"oklab"===r?.4*c:"oklch"===r?u<2?.4*c:360*c:c:c;if("h"===r[u]||2===u&&"h"===r[r.length-1]){if(void 0!==ks[c])return ks[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return 360*parseFloat(c);if(c.endsWith("grad"))return 360*parseFloat(c)/400;if(c.endsWith("rad"))return 180*parseFloat(c)/Math.PI}return"none"===c?0:parseFloat(c)})).length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(e=n.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=n.match(/([a-z])/gi)?.join("")?.toLowerCase()||"rgb");return{space:r,values:e,alpha:i}};var ks={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};const $i={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var r,s,o,a,l,t=n[0]/360,e=n[1]/100,i=n[2]/100,h=0;if(0===e)return[l=255*i,l,l];for(r=2*i-(s=i<.5?i*(1+e):i+e-i*e),a=[0,0,0];h<3;)(o=t+1/3*-(h-1))<0?o++:o>1&&o--,a[h++]=255*(l=6*o<1?r+6*(s-r)*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r);return a}};mn.hsl=function(n){var a,h,t=n[0]/255,e=n[1]/255,i=n[2]/255,r=Math.min(t,e,i),s=Math.max(t,e,i),o=s-r;return s===r?a=0:t===s?a=(e-i)/o:e===s?a=2+(i-t)/o:i===s&&(a=4+(t-e)/o),(a=Math.min(60*a,360))<0&&(a+=360),h=(r+s)/2,[a,100*(s===r?0:h<=.5?o/(s+r):o/(2-s-r)),100*h]};const Dl=1024,pn={};let Ji=0;function Fl(n){if(4===n.length)return n;const t=n.slice();return t[3]=1,t}function zs(n){const t=Ut.lchuv(mn.xyz(n));return t[3]=n[3],t}function Qi(n){if(pn.hasOwnProperty(n))return pn[n];if(Ji>=Dl){let e=0;for(const i in pn)3&e++||(delete pn[i],--Ji)}const t=function Sl(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var t,r=Ll(n);if(!r.space)return[];const s="h"===r.space[0]?$i.min:mn.min,o="h"===r.space[0]?$i.max:mn.max;return(t=Array(3))[0]=Math.min(Math.max(r.values[0],s[0]),o[0]),t[1]=Math.min(Math.max(r.values[1],s[1]),o[1]),t[2]=Math.min(Math.max(r.values[2],s[2]),o[2]),"h"===r.space[0]&&(t=$i.rgb(t)),t.push(Math.min(Math.max(r.alpha,0),1)),t}(n);if(4!==t.length)throw new Error('Failed to parse "'+n+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+n+'" as color');return Gs(t),pn[n]=t,++Ji,t}function yn(n){return Array.isArray(n)?n:Qi(n)}function Gs(n){return n[0]=at(n[0]+.5|0,0,255),n[1]=at(n[1]+.5|0,0,255),n[2]=at(n[2]+.5|0,0,255),n[3]=at(n[3],0,1),n}function tr(n){let t=n[0];t!=(0|t)&&(t=t+.5|0);let e=n[1];e!=(0|e)&&(e=e+.5|0);let i=n[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+t+","+e+","+i+","+(void 0===n[3]?1:Math.round(1e3*n[3])/1e3)+")"}const fe=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",zl=fe.includes("firefox"),Gl=(fe.includes("safari")&&!fe.includes("chrom")&&(fe.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(fe)),fe.includes("webkit")&&!fe.includes("edge")),Xs=fe.includes("macintosh"),Ys=typeof devicePixelRatio<"u"?devicePixelRatio:1,Zs=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Us=typeof Image<"u"&&Image.prototype.decode,js=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}();function At(n,t,e,i){let r;return r=e&&e.length?e.shift():Zs?new OffscreenCanvas(n||300,t||300):document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("2d",i)}let er;function ti(){return er||(er=At(1,1)),er}function nr(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function Ws(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function ir(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function rr(n,t,e){return t+":"+n+":"+(e?yn(e):"null")}const $t=new class jl{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_)!(3&t++)&&!this.cache_[e].hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}get(t,e,i){const r=rr(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=rr(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,s){const o=rr(t,e,i),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===Z_IDLE&&r.load(),r.getImageState()===Z_LOADING?r.ready().then(()=>{this.patternCache_[o]=ti().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=ti().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};let En=null;class Wl extends qt{constructor(t,e,i,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=void 0===r?Z_IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.ready_=null}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===Z_LOADED){En||(En=At(1,1,void 0,{willReadFrequently:!0})),En.drawImage(this.image_,0,0);try{En.getImageData(0,0,1,1),this.tainted_=!1}catch{En=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent("change")}handleImageError_(){this.imageState_=Z_ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Z_LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=At(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Z_IDLE){this.image_||this.initializeImage_(),this.imageState_=Z_LOADING;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&function Ks(n,t){return t&&(n.src=t),n.src&&Us?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(r=>n.complete&&n.width?e(n):i(r))):function Ul(n,t){return new Promise((e,i)=>{function r(){o(),e(n)}function s(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s),t&&(n.src=t)})}(n)}(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Z_LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const r=i.getContext("2d");r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=function Ol(n){return"string"==typeof n?n:tr(n)}(this.color_),r.fillRect(0,0,i.width/t,i.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===Z_LOADED||this.imageState_===Z_ERROR?t():this.addEventListener("change",function e(){(this.imageState_===Z_LOADED||this.imageState_===Z_ERROR)&&(this.removeEventListener("change",e),t())})})),this.ready_}}function sr(n,t,e,i,r,s){let o=void 0===t?void 0:$t.get(t,e,r);return o||(o=new Wl(n,n&&"src"in n?n.src||void 0:t,e,i,r),$t.set(t,e,r,o,s)),s&&o&&!$t.getPattern(t,e,r)&&$t.set(t,e,r,o,s),o}function Vs(n){return n?Array.isArray(n)?tr(n):"object"==typeof n&&"src"in n?function Kl(n){if(!n.offset||!n.size)return $t.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=$t.getPattern(t,void 0,n.color);if(e)return e;const i=$t.get(n.src,"anonymous",null);if(i.getImageState()!==Z_LOADED)return null;const r=At(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),sr(r.canvas,t,void 0,Z_LOADED,n.color,!0),$t.getPattern(t,void 0,n.color)}(n):n:null}const ei="ol-hidden",ni="ol-unselectable",or="ol-control",Bs="ol-collapsed",ae=(new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),new re);class hr extends Ds{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.imageState_=this.fill_&&this.fill_.loading()?Z_LOADING:Z_LOADED,this.imageState_===Z_LOADING&&this.ready().then(()=>this.imageState_=Z_LOADED),this.render()}clone(){const t=this.getScale(),e=new hr({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,r=At(i.size*t,i.size*t);this.draw_(i,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let r=this.radius_,s=void 0===this.radius2_?r:this.radius2_;if(r<s){const z=r;r=s,s=z}const a=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),l=s*Math.sin(a),c=r-Math.sqrt(s*s-l*l),u=Math.sqrt(l*l+c*c),d=u/l;if("miter"===t&&d<=i)return d*e;const f=e/2/d,g=e/2*(c/u),v=Math.sqrt((r+f)*(r+f)+g*g)-r;if(void 0===this.radius2_||"bevel"===t)return 2*v;const C=r*Math.sin(a),A=s-Math.sqrt(r*r-C*C),R=Math.sqrt(C*C+A*A)/C;return R<=i?2*Math.max(v,R*e/2-s-r):2*v}createRenderOptions(){let o,t="round",e="round",i=0,r=null,s=0,a=0;this.stroke_&&(o=Vs(this.stroke_.getColor()??"#000"),a=this.stroke_.getWidth()??1,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??"round",t=this.stroke_.getLineCap()??"round",i=this.stroke_.getMiterLimit()??10);const l=this.calculateLineJoinSize_(e,a,i),h=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:o,strokeWidth:a,size:Math.ceil(2*h+l),lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();null===r&&(r="#000"),e.fillStyle=Vs(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;"string"==typeof i&&(i=yn(i)),null===i?r=1:Array.isArray(i)&&(r=4===i.length?i[3]:1),0===r&&(e=At(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2==0?i:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle="#000",e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const eo=hr;class cr extends eo{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new cr({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const no=cr;class ur{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,void 0!==t.color&&this.setColor(t.color)}clone(){const t=this.getColor();return new ur({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(null!==t&&"object"==typeof t&&"src"in t){const e=sr(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===Z_IDLE&&e.load(),e.getImageState()===Z_LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const dr=ur;class fr{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new fr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const io=fr;class ge{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=so,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new ge({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=so,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let gr=null;function ro(n,t){if(!gr){const e=new dr({color:"rgba(255,255,255,0.4)"}),i=new io({color:"#3399CC",width:1.25});gr=[new ge({image:new no({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return gr}function so(n){return n.getGeometry()}const ri=ge;function oo(n,t,e,i){return void 0!==e&&void 0!==i?[e/n,i/t]:void 0!==e?e/n:void 0!==i?i/t:1}class _r extends Ds{constructor(t){super({opacity:void 0!==(t=t||{}).opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const o=void 0!==t.img?t.img:null;let l,a=t.src;if(H(!(void 0!==a&&o),"`image` and `src` cannot be provided at the same time"),(void 0===a||0===a.length)&&o&&(a=o.src||vt(o)),H(void 0!==a&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),H(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),"`width` or `height` cannot be provided together with `scale`"),void 0!==t.src?l=Z_IDLE:void 0!==o&&(l="complete"in o?o.complete?o.src?Z_LOADED:Z_IDLE:Z_LOADING:Z_LOADED),this.color_=void 0!==t.color?yn(t.color):null,this.iconImage_=sr(o,a,this.crossOrigin_,l,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,void 0!==t.width||void 0!==t.height){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(oo(f[0],f[1],t.width,t.height))};return void this.listenImageChange(d)}}void 0!==h&&this.setScale(oo(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new _r({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!r)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=r[0]),"fraction"==this.anchorYUnits_&&(t[1]*=r[1])}if("top-left"!=this.anchorOrigin_){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),("top-right"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[0]=-t[0]+r[0]),("bottom-left"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),("top-right"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[0]=i[0]-e[0]-t[0]),("bottom-left"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==Z_LOADED?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==Z_LOADED?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener("change",t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener("change",t)}ready(){return this.iconImage_.ready()}}const th=_r;class mr{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=xt(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new dr({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new mr({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xt(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const nh=mr;let De=0;const He=0,nt=1<<De++,L=1<<De++,bt=1<<De++,lt=1<<De++,Jt=1<<De++,vn=1<<De++,gt=Math.pow(2,6)-1,ao={[nt]:"boolean",[L]:"number",[bt]:"string",[lt]:"color",[Jt]:"number[]",[vn]:"size"},ih=Object.keys(ao).map(Number).sort(ne);function _t(n){const t=[];for(const e of ih)rh(n,e)&&t.push(ao[e]);return 0===t.length?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function rh(n,t){return(n&t)===t}function Qt(n,t){return!!(n&t)}function si(n,t){return n===t}class _e{constructor(t,e){this.type=t,this.value=e}}class sh{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function lo(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function B(n,t,e){switch(typeof n){case"boolean":return new _e(nt,n);case"number":return new _e(e===vn?vn:L,n);case"string":{let r=bt;return function kl(n){try{return Qi(n),!0}catch{return!1}}(n)&&(r|=lt),si(r&e,He)||(r&=e),new _e(r,n)}}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(0===n.length)throw new Error("Empty expression");if("string"==typeof n[0])return function yh(n,t,e){const i=n[0],r=ah[i];if(!r)throw new Error(`Unknown operator: ${i}`);return r(n,t,e)}(n,t,e);for(const r of n)if("number"!=typeof r)throw new Error("Expected an array of numbers");let i=Jt;return 2===n.length?i|=vn:(3===n.length||4===n.length)&&(i|=lt),e&&(i&=e),new _e(i,n)}const y={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},ah={[y.Get]:k(([n,t])=>void 0!==t?function oh(n){switch(n){case"string":return bt;case"color":return lt;case"number":return L;case"boolean":return nt;case"number[]":return Jt;default:throw new Error(`Unrecognized type hint: ${n}`)}}(t.value):gt,X(1,2),function lh(n,t){const e=B(n[1],t);if(!(e instanceof _e))throw new Error("Expected a literal argument for get operation");if("string"!=typeof e.value)throw new Error("Expected a string argument for get operation");return t.properties.add(e.value),3===n.length?[e,B(n[2],t)]:[e]}),[y.Var]:k(([n])=>n.type,X(1,1),function hh(n,t,e,i){const r=n[1];if("string"!=typeof r)throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||void 0===t.style.variables[r])return[new _e(gt,r)];const o=B(t.style.variables[r],t);if(o.value=r,i&&!Qt(i,o.type))throw new Error(`The variable ${r} has type ${_t(o.type)} but the following type was expected: ${_t(i)}`);return[o]}),[y.Id]:k(L|bt,wn,function ch(n,t){t.featureId=!0}),[y.Concat]:k(bt,X(2,1/0),W(gt)),[y.GeometryType]:k(bt,wn,function uh(n,t){t.geometryType=!0}),[y.Resolution]:k(L,wn),[y.Zoom]:k(L,wn),[y.Time]:k(L,wn),[y.Any]:k(nt,X(2,1/0),W(nt)),[y.All]:k(nt,X(2,1/0),W(nt)),[y.Not]:k(nt,X(1,1),W(nt)),[y.Equal]:k(nt,X(2,2),W(gt),me),[y.NotEqual]:k(nt,X(2,2),W(gt),me),[y.GreaterThan]:k(nt,X(2,2),W(gt),me),[y.GreaterThanOrEqualTo]:k(nt,X(2,2),W(gt),me),[y.LessThan]:k(nt,X(2,2),W(gt),me),[y.LessThanOrEqualTo]:k(nt,X(2,2),W(gt),me),[y.Multiply]:k(n=>{let t=L|lt;for(let e=0;e<n.length;e++)t&=n[e].type;return t},X(2,1/0),W(L|lt),me),[y.Coalesce]:k(n=>{let t=gt;for(let e=1;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},X(2,1/0),W(gt),me),[y.Divide]:k(L,X(2,2),W(L)),[y.Add]:k(L,X(2,1/0),W(L)),[y.Subtract]:k(L,X(2,2),W(L)),[y.Clamp]:k(L,X(3,3),W(L)),[y.Mod]:k(L,X(2,2),W(L)),[y.Pow]:k(L,X(2,2),W(L)),[y.Abs]:k(L,X(1,1),W(L)),[y.Floor]:k(L,X(1,1),W(L)),[y.Ceil]:k(L,X(1,1),W(L)),[y.Round]:k(L,X(1,1),W(L)),[y.Sin]:k(L,X(1,1),W(L)),[y.Cos]:k(L,X(1,1),W(L)),[y.Atan]:k(L,X(1,2),W(L)),[y.Sqrt]:k(L,X(1,1),W(L)),[y.Match]:k(n=>{let t=gt;for(let e=2;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},X(4,1/0),ho,function fh(n,t,e,i){const r=n.length-1;let o=B(n[1],t).type;const a=B(n[n.length-1],t);let l=void 0!==i?i&a.type:a.type;const h=new Array(r-2);for(let u=0;u<r-2;u+=2){const d=B(n[u+2],t),f=B(n[u+3],t);o&=d.type,l&=f.type,h[u]=d,h[u+1]=f}const c=bt|L|nt;if(!Qt(c,o))throw new Error(`Expected an input of type ${_t(c)} for the interpolate operation, got ${_t(o)} instead`);if(o&=c,si(l,He))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(n));for(let u=0;u<r-2;u+=2){const d=B(n[u+2],t,o),f=B(n[u+3],t,l);h[u]=d,h[u+1]=f}return[B(n[1],t,o),...h,B(n[n.length-1],t,l)]}),[y.Between]:k(nt,X(3,3),W(L)),[y.Interpolate]:k(n=>{let t=lt|L;for(let e=3;e<n.length;e+=2)t&=n[e].type;return t},X(6,1/0),ho,function gh(n,t,e,i){const r=n[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],"number"!=typeof s)throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=B(s,t);let o=B(n[2],t);if(!Qt(L,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${_t(o.type)} instead`);o=B(n[2],t,L);const a=new Array(n.length-3);for(let l=0;l<a.length;l+=2){let h=B(n[l+3],t);if(!Qt(L,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${_t(h.type)} at position ${l+2} instead`);let c=B(n[l+4],t);if(!Qt(L|lt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${_t(c.type)} at position ${l+3} instead`);h=B(n[l+3],t,L),c=B(n[l+4],t,L|lt),a[l]=h,a[l+1]=c}return[s,o,...a]}),[y.Case]:k(n=>{let t=gt;for(let e=1;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},X(3,1/0),function dh(n,t){const i=n.length-1;if(i%2==0)throw new Error(`An odd amount of arguments was expected for operation ${n[0]}, got ${JSON.stringify(i)} instead`)},function _h(n,t,e,i){const r=B(n[n.length-1],t,i);let s=void 0!==i?i&r.type:r.type;const o=new Array(n.length-1);for(let a=0;a<o.length-1;a+=2){const l=B(n[a+1],t),h=B(n[a+2],t,i);if(!Qt(nt,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${_t(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(si(s,He))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(n));for(let a=0;a<o.length-1;a+=2)o[a+1]=B(n[a+2],t,s);return o[o.length-1]=B(n[n.length-1],t,s),o}),[y.In]:k(nt,X(2,2),function mh(n,t){let e=n[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if("string"==typeof e[0]){if("literal"!==e[0])throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let i=bt|L;const r=new Array(e.length);for(let o=0;o<r.length;o++){const a=B(e[o],t);i&=a.type,r[o]=a}if(si(i,He))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(n));return[B(n[1],t,i),...r]}),[y.Number]:k(L,X(1,1/0),W(gt)),[y.String]:k(bt,X(1,1/0),W(gt)),[y.Array]:k(n=>2===n.length?Jt|vn:3===n.length||4===n.length?Jt|lt:Jt,X(1,1/0),W(L)),[y.Color]:k(lt,X(1,4),W(L)),[y.Band]:k(L,X(1,3),W(L)),[y.Palette]:k(lt,X(2,2),function ph(n,t){const e=B(n[1],t,L);if(e.type!==L)throw new Error(`The first argument of palette must be an number, got ${_t(e.type)} instead`);const i=n[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const r=new Array(i.length);for(let s=0;s<r.length;s++){const o=B(i[s],t,lt);if(!(o instanceof _e))throw new Error(`The palette color at index ${s} must be a literal value`);if(!Qt(o.type,lt))throw new Error(`The palette color at index ${s} should be of type color, got ${_t(o.type)} instead`);r[s]=o}return[e,...r]}),[y.ToString]:k(bt,X(1,1),W(nt|L|bt|lt))};function wn(n,t){if(1!==n.length)throw new Error(`Expected no arguments for ${n[0]} operation`);return[]}function X(n,t){return function(e,i){const r=e[0],s=e.length-1;if(n===t){if(s!==n)throw new Error(`Expected ${n} argument${1===n?"":"s"} for ${r}, got ${s}`)}else if(s<n||s>t)throw new Error(`Expected ${t===1/0?`${n} or more`:`${n} to ${t}`} arguments for ${r}, got ${s}`)}}function W(n){return function(t,e){const i=t[0],r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=B(t[o+1],e);if(!Qt(n,a.type)){const l=_t(n),h=_t(a.type);throw new Error(`Unexpected type for argument ${o} of ${i} operation, got ${l} but expected ${h}`)}a.type&=n,s[o]=a}return s}}function me(n,t,e){const i=n[0],r=n.length-1;let s=gt;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===He)throw new Error(`No common type could be found for arguments of ${i} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=B(n[a+1],t,s);return o}function ho(n,t){const i=n.length-1;if(i%2==1)throw new Error(`An even amount of arguments was expected for operation ${n[0]}, got ${JSON.stringify(i)} instead`)}function k(n,...t){return function(e,i,r){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,i,o,r)||o;let a="function"==typeof n?n(o):n;if(void 0!==r){if(!Qt(a,r))throw new Error(`The following expression was expected to return ${_t(r)}, but returns ${_t(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===He)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new sh(a,s,...o)}}function co(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return co(n.getGeometries()[0]);default:return""}}function le(n,t,e){const i=B(n,e);if(!Qt(t,i.type)){const r=_t(t),s=_t(i.type);throw new Error(`Expected expression to be of type ${r}, got ${s}`)}return jt(i,e)}function jt(n,t){if(n instanceof _e){if(n.type===lt&&"string"==typeof n.value){const i=Qi(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case y.Number:case y.String:case y.Coalesce:return function Eh(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=jt(n.args[s],t);switch(e){case y.Coalesce:return s=>{for(let o=0;o<i;++o){const a=r[o](s);if(typeof a<"u"&&null!==a)return a}throw new Error("Expected one of the values to be non-null")};case y.Number:case y.String:return s=>{for(let o=0;o<i;++o){const a=r[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}(n,t);case y.Get:case y.Var:return function vh(n,t){const i=n.args[0].value;switch(n.operator){case y.Get:return r=>r.properties[i];case y.Var:return r=>r.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}(n);case y.Id:return i=>i.featureId;case y.GeometryType:return i=>i.geometryType;case y.Concat:{const i=n.args.map(r=>jt(r,t));return r=>"".concat(...i.map(s=>s(r).toString()))}case y.Resolution:return i=>i.resolution;case y.Any:case y.All:case y.Between:case y.In:case y.Not:return function Ch(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=jt(n.args[s],t);switch(e){case y.Any:return s=>{for(let o=0;o<i;++o)if(r[o](s))return!0;return!1};case y.All:return s=>{for(let o=0;o<i;++o)if(!r[o](s))return!1;return!0};case y.Between:return s=>{const o=r[0](s),a=r[1](s),l=r[2](s);return o>=a&&o<=l};case y.In:return s=>{const o=r[0](s);for(let a=1;a<i;++a)if(o===r[a](s))return!0;return!1};case y.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}(n,t);case y.Equal:case y.NotEqual:case y.LessThan:case y.LessThanOrEqualTo:case y.GreaterThan:case y.GreaterThanOrEqualTo:return function wh(n,t){const e=n.operator,i=jt(n.args[0],t),r=jt(n.args[1],t);switch(e){case y.Equal:return s=>i(s)===r(s);case y.NotEqual:return s=>i(s)!==r(s);case y.LessThan:return s=>i(s)<r(s);case y.LessThanOrEqualTo:return s=>i(s)<=r(s);case y.GreaterThan:return s=>i(s)>r(s);case y.GreaterThanOrEqualTo:return s=>i(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}(n,t);case y.Multiply:case y.Divide:case y.Add:case y.Subtract:case y.Clamp:case y.Mod:case y.Pow:case y.Abs:case y.Floor:case y.Ceil:case y.Round:case y.Sin:case y.Cos:case y.Atan:case y.Sqrt:return function Th(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=jt(n.args[s],t);switch(e){case y.Multiply:return s=>{let o=1;for(let a=0;a<i;++a)o*=r[a](s);return o};case y.Divide:return s=>r[0](s)/r[1](s);case y.Add:return s=>{let o=0;for(let a=0;a<i;++a)o+=r[a](s);return o};case y.Subtract:return s=>r[0](s)-r[1](s);case y.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case y.Mod:return s=>r[0](s)%r[1](s);case y.Pow:return s=>Math.pow(r[0](s),r[1](s));case y.Abs:return s=>Math.abs(r[0](s));case y.Floor:return s=>Math.floor(r[0](s));case y.Ceil:return s=>Math.ceil(r[0](s));case y.Round:return s=>Math.round(r[0](s));case y.Sin:return s=>Math.sin(r[0](s));case y.Cos:return s=>Math.cos(r[0](s));case y.Atan:return 2===i?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case y.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}(n,t);case y.Case:return function Rh(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=jt(n.args[r],t);return r=>{for(let s=0;s<e-1;s+=2)if(i[s](r))return i[s+1](r);return i[e-1](r)}}(n,t);case y.Match:return function Ih(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=jt(n.args[r],t);return r=>{const s=i[0](r);for(let o=1;o<e;o+=2)if(s===i[o](r))return i[o+1](r);return i[e-1](r)}}(n,t);case y.Interpolate:return function Mh(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=jt(n.args[r],t);return r=>{const s=i[0](r),o=i[1](r);let a,l;for(let h=2;h<e;h+=2){const c=i[h](r);let u=i[h+1](r);const d=Array.isArray(u);if(d&&(u=Fl(u)),c>=o)return 2===h?u:d?Ah(s,o,a,l,c,u):Cn(s,o,a,l,c,u);a=c,l=u}return l}}(n,t);case y.ToString:return function xh(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=jt(n.args[s],t);if(e===y.ToString)return s=>{const o=r[0](s);return n.args[0].type===lt?tr(o):o.toString()};throw new Error(`Unsupported convert operator ${e}`)}(n,t);default:throw new Error(`Unsupported operator ${e}`)}}function Cn(n,t,e,i,r,s){const o=r-e;if(0===o)return i;const a=t-e;return i+(1===n?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1))*(s-i)}function Ah(n,t,e,i,r,s){if(r-e==0)return i;const a=zs(i),l=zs(s);let h=l[2]-a[2];return h>180?h-=360:h<-180&&(h+=360),Gs(function Nl(n){const t=Ut.rgb(bl.xyz(n));return t[3]=n[3],t}([Cn(n,t,e,a[0],r,l[0]),Cn(n,t,e,a[1],r,l[1]),a[2]+Cn(n,t,e,0,r,h),Cn(n,t,e,i[3],r,s[3])]))}function bh(n){return!0}function Lh(n){const t=lo(),e=function Ph(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r){const s=n[r],o="filter"in s?le(s.filter,nt,t):bh;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=pr(s.style[h],t)}else a=[pr(s.style,t)];i[r]={filter:o,styles:a}}return function(r){const s=[];let o=!1;for(let a=0;a<e;++a)if((0,i[a].filter)(r)&&(!n[a].else||!o)){o=!0;for(const h of i[a].styles){const c=h(r);c&&s.push(c)}}return s}}(n,t),i={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""};return function(r,s){if(i.properties=r.getPropertiesInternal(),i.resolution=s,t.featureId){const o=r.getId();i.featureId=void 0!==o?o:null}return t.geometryType&&(i.geometryType=co(r.getGeometry())),e(i)}}function fo(n){const t=lo(),e=n.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=pr(n[o],t);const r={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""},s=new Array(e);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,t.featureId){const h=o.getId();r.featureId=void 0!==h?h:null}let l=0;for(let h=0;h<e;++h){const c=i[h](r);c&&(s[l]=c,l+=1)}return s.length=l,s}}function pr(n,t){const e=Tn(n,"",t),i=Rn(n,"",t),r=function Sh(n,t){const e="text-",i=he(n,e+"value",t);if(!i)return null;const r=Tn(n,e,t),s=Tn(n,e+"background-",t),o=Rn(n,e,t),a=Rn(n,e+"background-",t),l=he(n,e+"font",t),h=It(n,e+"max-angle",t),c=It(n,e+"offset-x",t),u=It(n,e+"offset-y",t),d=In(n,e+"overflow",t),f=he(n,e+"placement",t),g=It(n,e+"repeat",t),p=ai(n,e+"scale",t),v=In(n,e+"rotate-with-view",t),C=It(n,e+"rotation",t),w=he(n,e+"align",t),A=he(n,e+"justify",t),I=he(n,e+"baseline",t),R=go(n,e+"padding",t),z=hi(n,e+"declutter-mode"),F=new nh({declutterMode:z});return function(O){if(F.setText(i(O)),r&&F.setFill(r(O)),s&&F.setBackgroundFill(s(O)),o&&F.setStroke(o(O)),a&&F.setBackgroundStroke(a(O)),l&&F.setFont(l(O)),h&&F.setMaxAngle(h(O)),c&&F.setOffsetX(c(O)),u&&F.setOffsetY(u(O)),d&&F.setOverflow(d(O)),f){const N=f(O);if("point"!==N&&"line"!==N)throw new Error("Expected point or line for text-placement");F.setPlacement(N)}if(g&&F.setRepeat(g(O)),p&&F.setScale(p(O)),v&&F.setRotateWithView(v(O)),C&&F.setRotation(C(O)),w){const N=w(O);if("left"!==N&&"center"!==N&&"right"!==N&&"end"!==N&&"start"!==N)throw new Error("Expected left, right, center, start, or end for text-align");F.setTextAlign(N)}if(A){const N=A(O);if("left"!==N&&"right"!==N&&"center"!==N)throw new Error("Expected left, right, or center for text-justify");F.setJustify(N)}if(I){const N=I(O);if("bottom"!==N&&"top"!==N&&"middle"!==N&&"alphabetic"!==N&&"hanging"!==N)throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");F.setTextBaseline(N)}return R&&F.setPadding(R(O)),F}}(n,t),s=function Oh(n,t){return"icon-src"in n?function Dh(n,t){const e="icon-",i=e+"src",r=yo(n[i],i),s=oi(n,e+"anchor",t),o=ai(n,e+"scale",t),a=It(n,e+"opacity",t),l=oi(n,e+"displacement",t),h=It(n,e+"rotation",t),c=In(n,e+"rotate-with-view",t),u=mo(n,e+"anchor-origin"),d=po(n,e+"anchor-x-units"),f=po(n,e+"anchor-y-units"),g=function Yh(n,t){const e=n[t];if(void 0!==e)return Eo(e,t)}(n,e+"color"),p=function Gh(n,t){const e=n[t];if(void 0!==e){if("string"!=typeof e)throw new Error(`Expected a string for ${t}`);return e}}(n,e+"cross-origin"),v=function Xh(n,t){const e=n[t];if(void 0!==e)return Mn(e,t)}(n,e+"offset"),C=mo(n,e+"offset-origin"),w=li(n,e+"width"),A=li(n,e+"height"),I=function zh(n,t){const e=n[t];if(void 0!==e){if("number"==typeof e)return xt(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1])throw new Error(`Expected a number or size array for ${t}`);return e}}(n,e+"size"),R=hi(n,e+"declutter-mode"),z=new th({src:r,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:p,offset:v,offsetOrigin:C,height:A,width:w,size:I,declutterMode:R});return function(F){return a&&z.setOpacity(a(F)),l&&z.setDisplacement(l(F)),h&&z.setRotation(h(F)),c&&z.setRotateWithView(c(F)),o&&z.setScale(o(F)),s&&z.setAnchor(s(F)),z}}(n,t):"shape-points"in n?function Fh(n,t){const e="shape-",i=e+"points",r=e+"radius",s=Er(n[i],i),o=Er(n[r],r),a=Tn(n,e,t),l=Rn(n,e,t),h=ai(n,e+"scale",t),c=oi(n,e+"displacement",t),u=It(n,e+"rotation",t),d=In(n,e+"rotate-with-view",t),f=li(n,e+"radius2"),g=li(n,e+"angle"),p=hi(n,e+"declutter-mode"),v=new eo({points:s,radius:o,radius2:f,angle:g,declutterMode:p});return function(C){return a&&v.setFill(a(C)),l&&v.setStroke(l(C)),c&&v.setDisplacement(c(C)),u&&v.setRotation(u(C)),d&&v.setRotateWithView(d(C)),h&&v.setScale(h(C)),v}}(n,t):"circle-radius"in n?function Nh(n,t){const e="circle-",i=Tn(n,e,t),r=Rn(n,e,t),s=It(n,e+"radius",t),o=ai(n,e+"scale",t),a=oi(n,e+"displacement",t),l=It(n,e+"rotation",t),h=In(n,e+"rotate-with-view",t),c=hi(n,e+"declutter-mode"),u=new no({radius:5,declutterMode:c});return function(d){return s&&u.setRadius(s(d)),i&&u.setFill(i(d)),r&&u.setStroke(r(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}(n,t):null}(n,t),o=It(n,"z-index",t);if(!(e||i||r||s||V(n)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const a=new ri;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(r){const c=r(l);c&&(h=!1),a.setText(c)}if(s){const c=s(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Tn(n,t,e){let i;if(i=t+"fill-pattern-src"in n?function kh(n,t,e){const i=he(n,t+"pattern-src",e),r=_o(n,t+"pattern-offset",e),s=_o(n,t+"pattern-size",e),o=yr(n,t+"color",e);return function(a){return{src:i(a),offset:r&&r(a),size:s&&s(a),color:o&&o(a)}}}(n,t+"fill-",e):yr(n,t+"fill-color",e),!i)return null;const r=new dr;return function(s){const o=i(s);return"none"===o?null:(r.setColor(o),r)}}function Rn(n,t,e){const i=It(n,t+"stroke-width",e),r=yr(n,t+"stroke-color",e);if(!i&&!r)return null;const s=he(n,t+"stroke-line-cap",e),o=he(n,t+"stroke-line-join",e),a=go(n,t+"stroke-line-dash",e),l=It(n,t+"stroke-line-dash-offset",e),h=It(n,t+"stroke-miter-limit",e),c=new io;return function(u){if(r){const d=r(u);if("none"===d)return null;c.setColor(d)}if(i&&c.setWidth(i(u)),s){const d=s(u);if("butt"!==d&&"round"!==d&&"square"!==d)throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if("bevel"!==d&&"round"!==d&&"miter"!==d)throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function It(n,t,e){if(!(t in n))return;const i=le(n[t],L,e);return function(r){return Er(i(r),t)}}function he(n,t,e){if(!(t in n))return null;const i=le(n[t],bt,e);return function(r){return yo(i(r),t)}}function In(n,t,e){if(!(t in n))return null;const i=le(n[t],nt,e);return function(r){const s=i(r);if("boolean"!=typeof s)throw new Error(`Expected a boolean for ${t}`);return s}}function yr(n,t,e){if(!(t in n))return null;const i=le(n[t],lt|bt,e);return function(r){return Eo(i(r),t)}}function go(n,t,e){if(!(t in n))return null;const i=le(n[t],Jt,e);return function(r){return Mn(i(r),t)}}function oi(n,t,e){if(!(t in n))return null;const i=le(n[t],Jt,e);return function(r){const s=Mn(i(r),t);if(2!==s.length)throw new Error(`Expected two numbers for ${t}`);return s}}function _o(n,t,e){if(!(t in n))return null;const i=le(n[t],Jt,e);return function(r){return vo(i(r),t)}}function ai(n,t,e){if(!(t in n))return null;const i=le(n[t],Jt|L,e);return function(r){return function Zh(n,t){return"number"==typeof n?n:vo(n,t)}(i(r),t)}}function li(n,t){const e=n[t];if(void 0!==e){if("number"!=typeof e)throw new Error(`Expected a number for ${t}`);return e}}function mo(n,t){const e=n[t];if(void 0!==e){if("bottom-left"!==e&&"bottom-right"!==e&&"top-left"!==e&&"top-right"!==e)throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function po(n,t){const e=n[t];if(void 0!==e){if("pixels"!==e&&"fraction"!==e)throw new Error(`Expected pixels or fraction for ${t}`);return e}}function hi(n,t){const e=n[t];if(void 0!==e){if("string"!=typeof e)throw new Error(`Expected a string for ${t}`);if("declutter"!==e&&"obstacle"!==e&&"none"!==e)throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Mn(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if("number"!=typeof n[i])throw new Error(`Expected an array of numbers for ${t}`);return n}function yo(n,t){if("string"!=typeof n)throw new Error(`Expected a string for ${t}`);return n}function Er(n,t){if("number"!=typeof n)throw new Error(`Expected a number for ${t}`);return n}function Eo(n,t){if("string"==typeof n)return n;const e=Mn(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function vo(n,t){const e=Mn(n,t);if(2!==e.length)throw new Error(`Expected an array of two numbers for ${t}`);return e}const Wh=class Uh extends Qn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get("renderOrder")}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new xl(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set("renderOrder",t)}setStyle(t){this.style_=void 0===t?ro:t;const e=function jh(n){if(void 0===n)return ro;if(!n)return null;if("function"==typeof n||n instanceof ri)return n;if(!Array.isArray(n))return fo([n]);if(0===n.length)return[];const t=n.length,e=n[0];if(e instanceof ri){const r=new Array(t);for(let s=0;s<t;++s){const o=n[s];if(!(o instanceof ri))throw new Error("Expected a list of style instances");r[s]=o}return r}if("style"in e){const r=new Array(t);for(let s=0;s<t;++s){const o=n[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");r[s]=o}return Lh(r)}return fo(n)}(t);this.styleFunction_=null===t?void 0:function Ql(n){let t;if("function"==typeof n)t=n;else{let e;Array.isArray(n)?e=n:(H("function"==typeof n.getZIndex,"Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}(e),this.changed()}};function Vh(n,t){$t.expire()}const Bh=class Kh extends Te{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){K()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;Ve(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),zi(r,i)}forEachFeatureAtCoordinate(t,e,i,r,s,o,a,l){let h;const c=e.viewState;function u(I,R,z,F){return s.call(o,R,I?z:null,F)}const d=c.projection,f=function Ga(n,t){if(t.canWrapX()){const e=Q(t.getExtent()),i=function Xa(n,t,e){const i=t.getExtent();let r=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||Q(i),r=Math.floor((n[0]-i[0])/e)),r}(n,t,e);i&&(n[0]-=i*e)}return n}(t.slice(),d),g=[[0,0]];if(d.canWrapX()&&r){const R=Q(d.getExtent());g.push([-R,0],[R,0])}const p=e.layerStatesArray,v=p.length,C=[],w=[];for(let I=0;I<g.length;I++)for(let R=v-1;R>=0;--R){const z=p[R],F=z.layer;if(F.hasRenderer()&&Bi(z,c)&&a.call(l,F)){const O=F.getRenderer(),N=F.getSource();if(O&&N){const rt=N.getWrapX()?f:t,pt=u.bind(null,z.managed);w[0]=rt[0]+g[I][0],w[1]=rt[1]+g[I][1],h=O.forEachFeatureAtCoordinate(w,e,i,pt,C)}if(h)return h}}if(0===C.length)return;const A=1/C.length;return C.forEach((I,R)=>I.distanceSq+=R*A),C.sort((I,R)=>I.distanceSq-R.distanceSq),C.some(I=>h=I.callback(I.feature,I.layer,I.geometry)),h}hasFeatureAtCoordinate(t,e,i,r,s,o){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,r,M,this,s,o)}getMap(){return this.map_}renderFrame(t){K()}scheduleExpireIconCache(t){$t.canExpireCache()&&t.postRenderFunctions.push(Vh)}},Co=class qh extends Ct{constructor(t,e,i,r){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=r}},$h=class Hh extends Bh{constructor(t){super(t),this.fontChangeListenerKey_=Y(ae,"propertychange",t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=ni+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const r=new Co(t,void 0,e);i.dispatchEvent(r)}}disposeInternal(){et(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent("precompose",t);const e=t.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});e.some(a=>a.layer instanceof Wh&&a.layer.getDeclutter())&&(t.declutter={});const r=t.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=e.length;a<l;++a){const h=e[a];t.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!Bi(h,r)||"ready"!=u&&"undefined"!=u){c.unrender();continue}const d=c.render(t,o);d&&(d!==o&&(this.children_.push(d),o=d),s.push(h))}this.declutter(t,s),function Yl(n,t){const e=n.childNodes;for(let i=0;;++i){const r=e[i],s=t[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let i=e.length-1;i>=0;--i){const r=e[i],s=r.layer;s.getDeclutter()&&s.renderDeclutter(t,r)}e.forEach(i=>i.layer.renderDeferred(t))}}};class pe extends Ct{constructor(t,e){super(t),this.layer=e}}class wr extends Gr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener("layers",this.handleLayersChanged_),i?Array.isArray(i)?i=new se(i.slice(),{unique:!0}):H("function"==typeof i.getArray,"Expected `layers` to be an array or a `Collection`"):i=new se(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(et),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(Y(t,"add",this.handleLayersAdd_,this),Y(t,"remove",this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(et);J(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const s=e[i];this.registerLayerListeners_(s),this.dispatchEvent(new pe("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[Y(t,"propertychange",this.handleLayerChange_,this),Y(t,"change",this.handleLayerChange_,this)];t instanceof wr&&e.push(Y(t,"addlayer",this.handleLayerGroupAdd_,this),Y(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[vt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new pe("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new pe("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new pe("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=vt(e);this.listenerKeys_[i].forEach(et),delete this.listenerKeys_[i],this.dispatchEvent(new pe("removelayer",e)),this.changed()}getLayers(){return this.get("layers")}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new pe("removelayer",i[r]))}this.set("layers",t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&void 0===r.zIndex&&(s=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),void 0!==r.extent&&(l.extent=void 0!==l.extent?Ue(l.extent,r.extent):r.extent),void 0===l.zIndex&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const ci=wr,$e=class Jh extends Ct{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},ye=class Qh extends $e{constructor(t,e,i,r,s,o){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==r&&r,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},it={SINGLECLICK:"singleclick",CLICK:"click",DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ec=class tc extends qt{constructor(t,e){super(t),this.map_=t,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=Y(i,"pointerdown",this.handlePointerDown_,this),this.relayedListenerKey_=Y(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener("touchmove",this.boundHandleTouchMove_,!!js&&{passive:!1})}emulateClick_(t){let e=new ye(it.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new ye(it.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new ye(it.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==it.POINTERUP||e.type==it.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==it.POINTERDOWN||e.type==it.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new ye(it.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(et),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new ye(it.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),0===this.dragListenerKeys_.length){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Y(i,it.POINTERMOVE,this.handlePointerMove_,this),Y(i,it.POINTERUP,this.handlePointerUp_,this),Y(this.element_,it.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(Y(this.element_.getRootNode(),it.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new ye(it.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new ye(it.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&("boolean"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(et(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener("touchmove",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(et(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(et),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},ui=1/0,ic=class nc{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,J(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(t){H(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=ui&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,r=e.length,s=e[t],o=i[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=s,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,r=this.priorities_,s=i[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(!(r[a]>o))break;i[e]=i[a],r[e]=r[a],e=a}i[e]=s,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let r=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==ui?delete this.queuedElements_[this.keyFunction_(o)]:(i[r]=l,e[r++]=o);e.length=r,i.length=r,this.heapify_()}},sc=class rc extends ic{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener("change",this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener("change",this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let r,s,o,i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),0===r&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}};var ac=ot(5861);const Tr=class lc extends re{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){ir(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&ir(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)et(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==G&&this.listenerKeys.push(Y(t,"postrender",this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},cc=class hc extends Tr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",r=void 0!==t.expandClassName?t.expandClassName:e+"-expand",s=void 0!==t.collapseLabel?t.collapseLabel:"\u203a",o=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=void 0!==t.label?t.label:"i";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener("click",this.handleClick_.bind(this),!1);const c=this.element;c.className=e+" "+ni+" "+or+(this.collapsed_&&this.collapsible_?" "+Bs:"")+(this.collapsible_?"":" ol-uncollapsible"),c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),i=!this.getMap().getAllLayers().some(r=>r.getSource()&&!1===r.getSource().getAttributionsCollapsible());return this.overrideCollapsible_||this.setCollapsible(i),e}updateElement_(t){var e=this;return(0,ac.Z)(function*(){if(!t)return void(e.renderedVisible_&&(e.element.style.display="none",e.renderedVisible_=!1));const i=yield Promise.all(e.collectSourceAttributions_(t).map(s=>function j(n){return function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}()}(()=>s))),r=i.length>0;if(e.renderedVisible_!=r&&(e.element.style.display=r?"":"none",e.renderedVisible_=r),!T(i,e.renderedAttributions_)){!function Xl(n){for(;n.lastChild;)n.removeChild(n.lastChild)}(e.ulElement_);for(let s=0,o=i.length;s<o;++s){const a=document.createElement("li");a.innerHTML=i[s],e.ulElement_.appendChild(a)}e.renderedAttributions_=i}})()}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Bs),this.collapsed_?Ws(this.collapseLabel_,this.label_):Ws(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},dc=class uc extends Tr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"\u21e7",r=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener("click",this.handleClick_.bind(this),!1);const l=this.element;l.className=e+" "+ni+" "+or,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ei)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Ke}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(ei);s||0!==i?s&&0!==i&&this.element.classList.remove(ei):this.element.classList.add(ei)}this.label_.style.transform=r}this.rotation_=i}},gc=class fc extends Tr{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,r=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",s=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",o=void 0!==t.zoomInLabel?t.zoomInLabel:"+",a=void 0!==t.zoomOutLabel?t.zoomOutLabel:"\u2013",l=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",h=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener("click",this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild("string"==typeof a?document.createTextNode(a):a),u.addEventListener("click",this.handleClick_.bind(this,-i),!1);const f=this.element;f.className=e+" "+ni+" "+or,f.appendChild(c),f.appendChild(u),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(void 0!==r){const s=i.getConstrainedZoom(r+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:Ke})):i.setZoom(s)}}};function Rr(n,t,e,i){const r=n.getZoom();if(void 0===r)return;const s=n.getConstrainedZoom(r+t),o=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:e,duration:void 0!==i?i:250,easing:Ke})}const xn=class mc extends re{constructor(t){super(),t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get("active")}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set("active",t)}setMap(t){this.map_=t}},Ec=class yc extends xn{constructor(t){super(),this.delta_=(t=t||{}).delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==it.DBLCLICK){const i=t.originalEvent,s=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_;Rr(t.map.getView(),o,s,this.duration_),i.preventDefault(),e=!0}return!e}};function Ir(n){const t=n.length;let e=0,i=0;for(let r=0;r<t;r++)e+=n[r].clientX,i+=n[r].clientY;return{clientX:e/t,clientY:i/t}}const Fe=class vc extends xn{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==it.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==it.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==it.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==it.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function Mr(n){const t=arguments;return function(e){let i=!0;for(let r=0,s=t.length;r<s&&(i=i&&t[r](e),i);++r);return i}}const wc=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ro=function(n){return!n.map.getTargetElement().hasAttribute("tabindex")||function(n){const t=n.map.getTargetElement(),e=n.map.getOwnerDocument().activeElement;return t.contains(e)}(n)},Tc=M,Io=function(n){const t=n.originalEvent;return 0==t.button&&!(Gl&&Xs&&t.ctrlKey)},Mo=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Ic=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},xo=function(n){const t=n.originalEvent,e=t.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&!t.target.isContentEditable},xr=function(n){const t=n.originalEvent;return H(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"mouse"==t.pointerType},Mc=function(n){const t=n.originalEvent;return H(void 0!==t,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&0===t.button},Ac=class xc extends Fe{constructor(t){super({stopDown:P}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.panning_=!1;const e=t.condition?t.condition:Mr(Mo,Mc);this.condition_=t.onFocusOnly?Mr(Ro,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,r=e.getEventPixel(Ir(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=t.map.getView();(function ka(n,t){n[0]*=t,n[1]*=t})(s,a.getResolution()),Ii(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Ke})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Lc=class bc extends Fe{constructor(t){t=t||{},super({stopDown:P}),this.condition_=t.condition?t.condition:wc,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!xr(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Di)return;const r=e.getSize(),s=t.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(o-this.lastAngle_)),this.lastAngle_=o}handleUpEvent(t){return!xr(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!(xr(t)&&Io(t)&&this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)}},Sc=class Pc extends Te{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+i,r.top=Math.min(t[1],e[1])+i,r.width=Math.abs(e[0]-t[0])+i,r.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new El([r])}getGeometry(){return this.geometry_}};class di extends Ct{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Dc=class Oc extends Fe{constructor(t){super(),this.box_=new Sc((t=t||{}).className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Io,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const r=i[0]-e[0],s=i[1]-e[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new di("boxdrag",t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new di(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new di("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new di("boxcancel",this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}},Nc=class Fc extends Dc{constructor(t){super({condition:(t=t||{}).condition?t.condition:Ic,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(r),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;r=r.clone(),r.scale(a*a)}i.fitInternal(r,{duration:this.duration_,easing:Ke})}},zc=class kc extends xn{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Mo(e)&&xo(e)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if("keydown"==t.type){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&("ArrowDown"==r||"ArrowLeft"==r||"ArrowRight"==r||"ArrowUp"==r)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;"ArrowDown"==r?h=-a:"ArrowLeft"==r?l=-a:"ArrowRight"==r?l=a:h=a;const c=[l,h];Ii(c,o.getRotation()),function pc(n,t,e){const i=n.getCenterInternal();i&&n.animateInternal({duration:void 0!==e?e:250,easing:el,center:n.getConstrainedCenter([i[0]+t[0],i[1]+t[1]])})}(o,c,this.duration_),i.preventDefault(),e=!0}}return!e}},Xc=class Gc extends xn{constructor(t){super(),this.condition_=(t=t||{}).condition?t.condition:function(e){return!function(n){const t=n.originalEvent;return Xs?t.metaKey:t.ctrlKey}(e)&&xo(e)},this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if("keydown"==t.type||"keypress"==t.type){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&("+"===r||"-"===r)){const o="+"===r?this.delta_:-this.delta_;Rr(t.map.getView(),o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Zc=class Yc{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;const s=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},jc=class Uc extends xn{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:Tc;this.condition_=t.onFocusOnly?Mr(Ro,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||"wheel"!==t.type)return!0;const i=t.map,r=t.originalEvent;let s;if(r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),"wheel"==t.type&&(s=r.deltaY,zl&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Ys),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),0===s)return!1;this.lastDelta_=s;const o=Date.now();void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if("trackpad"===this.mode_&&!a.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-at(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Rr(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Kc=class Wc extends Fe{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=P),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(void 0!==this.lastAngle_){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;const o=t.map,a=o.getView();a.getConstraints().rotation!==Di&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Ir(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Bc=class Vc extends Fe{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=P),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],r=this.targetPointers[1],s=i.clientX-r.clientX,o=i.clientY-r.clientY,a=Math.sqrt(s*s+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();1!=e&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Ir(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function Ar(n){n=n||{};const t=new se,e=new Zc(-.005,.05,100);return(void 0===n.altShiftDragRotate||n.altShiftDragRotate)&&t.push(new Lc),(void 0===n.doubleClickZoom||n.doubleClickZoom)&&t.push(new Ec({delta:n.zoomDelta,duration:n.zoomDuration})),(void 0===n.dragPan||n.dragPan)&&t.push(new Ac({onFocusOnly:n.onFocusOnly,kinetic:e})),(void 0===n.pinchRotate||n.pinchRotate)&&t.push(new Kc),(void 0===n.pinchZoom||n.pinchZoom)&&t.push(new Bc({duration:n.zoomDuration})),(void 0===n.keyboard||n.keyboard)&&(t.push(new zc),t.push(new Xc({delta:n.zoomDelta,duration:n.zoomDuration}))),(void 0===n.mouseWheelZoom||n.mouseWheelZoom)&&t.push(new jc({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(void 0===n.shiftDragZoom||n.shiftDragZoom)&&t.push(new Nc({duration:n.zoomDuration})),t}function Ao(n){n instanceof Qn?n.setMapInternal(null):n instanceof ci&&n.getLayers().forEach(Ao)}function bo(n,t){if(n instanceof Qn)n.setMapInternal(t);else if(n instanceof ci){const e=n.getLayers().getArray();for(let i=0,r=e.length;i<r;++i)bo(e[i],t)}}const Lo=class qc extends re{constructor(t){super();const e=function Hc(n){let t=null;void 0!==n.keyboardEventTarget&&(t="string"==typeof n.keyboardEventTarget?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&"function"==typeof n.layers.getLayers?n.layers:new ci({layers:n.layers});let r,s,o;return e.layergroup=i,e.target=n.target,e.view=n.view instanceof Zt?n.view:new Zt,void 0!==n.controls&&(Array.isArray(n.controls)?r=new se(n.controls.slice()):(H("function"==typeof n.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls)),void 0!==n.interactions&&(Array.isArray(n.interactions)?s=new se(n.interactions.slice()):(H("function"==typeof n.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),s=n.interactions)),void 0!==n.overlays?Array.isArray(n.overlays)?o=new se(n.overlays.slice()):(H("function"==typeof n.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new se,{controls:r,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}(t=t||{});this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Ys,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||function _c(n){n=n||{};const t=new se;return(void 0===n.zoom||n.zoom)&&t.push(new gc(n.zoomOptions)),(void 0===n.rotate||n.rotate)&&t.push(new dc(n.rotateOptions)),(void 0===n.attribution||n.attribution)&&t.push(new cc(n.attributionOptions)),t}(),this.interactions=e.interactions||Ar({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new sc(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener("layergroup",this.handleLayerGroupChanged_),this.addChangeListener("view",this.handleViewChanged_),this.addChangeListener("size",this.handleSizeChanged_),this.addChangeListener("target",this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof Zt)&&t.view.then(function(r){i.setView(new Zt(r))}),this.controls.addEventListener("add",r=>{r.element.setMap(this)}),this.controls.addEventListener("remove",r=>{r.element.setMap(null)}),this.interactions.addEventListener("add",r=>{r.element.setMap(this)}),this.interactions.addEventListener("remove",r=>{r.element.setMap(null)}),this.overlays_.addEventListener("add",r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener("remove",r=>{const s=r.element.getId();void 0!==s&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){bo(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:M,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(r){i.push(r)},e),i}getAllLayers(){const t=[];return function e(i){i.forEach(function(r){r instanceof ci?e(r.getLayers()):t.push(r)})}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:M,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-i.left)/(i.width/r[0]),(a.clientY-i.top)/(i.height/r[1])]}getTarget(){return this.get("target")}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Pi(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Ot(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get("layergroup")}setLayers(t){const e=this.getLayerGroup();if(t instanceof se)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=oe(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Ot(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get("size")}getView(){return this.get("view")}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,r){return function oc(n,t,e,i,r){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return ui;const s=n.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}(this.frameState_,t,e,i,r)}handleBrowserEvent(t,e){const i=new ye(e=e||t.type,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if("pointerdown"===i||"wheel"===i||"keydown"===i){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===r?r.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()===this&&o.getActive()&&this.getTargetElement()&&(!o.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,s=r;if(t){const o=t.viewHints;if(o[0]||o[1]){const a=Date.now()-t.time>8;r=a?0:8,s=a?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,s))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener("rendercomplete")&&this.renderer_.dispatchRenderEvent("rendercomplete",t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new $e("loadend",this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new $e("loadstart",this,t))));const i=this.postRenderFunctions_;for(let r=0,s=i.length;r<s;++r)i[r](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)et(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener("contextmenu",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener("wheel",this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ir(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new $h(this)),this.mapBrowserEventHandler_=new ec(this,this.moveTolerance_);for(const s in it)this.mapBrowserEventHandler_.addEventListener(it[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener("contextmenu",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener("wheel",this.boundHandleBrowserEvent_,!!js&&{passive:!1});const i=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[Y(i,"keydown",this.handleBrowserEvent,this),Y(i,"keypress",this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(et(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(et(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Y(t,"propertychange",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Y(t,"change",this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(et),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new pe("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Y(t,"propertychange",this.render,this),Y(t,"change",this.render,this),Y(t,"addlayer",this.handleLayerAdd_,this),Y(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Ao(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),r=this.frameState_;let s=null;if(void 0!==e&&Os(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Ti(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:vt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=Ti(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!un(this.previousExtent_)&&!Ci(s.extent,this.previousExtent_))&&(this.dispatchEvent(new $e("movestart",this,r)),this.previousExtent_=Ae(this.previousExtent_)),this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!Ci(s.extent,this.previousExtent_)&&(this.dispatchEvent(new $e("moveend",this,s)),function wa(n,t){t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]):n.slice()}(s.extent,this.previousExtent_))),this.dispatchEvent(new $e("postrender",this,s)),this.renderComplete_=this.hasListener("loadstart")||this.hasListener("loadend")||this.hasListener("rendercomplete")?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new pe("removelayer",e)),this.set("layergroup",t)}setSize(t){this.set("size",t)}setTarget(t){this.set("target",t)}setView(t){if(!t||t instanceof Zt)return void this.set("view",t);this.set("view",new Zt);const e=this;t.then(function(i){e.setView(new Zt(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),s=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(e=[s,o],!Os(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Qr("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!T(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}},Jc=class $c extends Qn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get("preload")}setPreload(t){this.set("preload",t)}getUseInterimTilesOnError(){return this.get("useInterimTilesOnError")}setUseInterimTilesOnError(t){this.set("useInterimTilesOnError",t)}getData(t){return super.getData(t)}},tu=class Qc extends Tt{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t}getFeatures(t){return K()}getData(t){return null}prepareFrame(t){return K()}renderFrame(t,e){return K()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(r,s)=>{const o=this.loadedTileCallback.bind(this,i,r);return t.forEachLoadedTile(e,r,s,o)}}forEachFeatureAtCoordinate(t,e,i,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===Z_LOADED||e.getState()===Z_ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Z_LOADED&&e!=Z_ERROR&&t.addEventListener("change",this.boundHandleImageChange_),e==Z_IDLE&&(t.load(),e=t.getState()),e==Z_LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},nu=class eu{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(ti(),{get:(t,e)=>{if("function"==typeof ti()[e])return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,r=e.length;i<r;++i){const s=e[i];if("function"==typeof s){s(t);continue}const o=e[++i];if("function"==typeof t[s])t[s](...o);else{if("function"==typeof o){t[s]=o(t);continue}t[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}};let Je=null;const su=class ru extends tu{constructor(t){super(t),this.container=null,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let r;Je||function iu(){Je=At(1,1,void 0,{willReadFrequently:!0})}(),Je.clearRect(0,0,1,1);try{Je.drawImage(t,e,i,1,1,0,0,1,1),r=Je.getImageData(0,0,1,1).data}catch{return Je=null,null}return r}getBackground(t){let i=this.getLayer().getBackground();return"function"==typeof i&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const r=this.getLayer().getClassName();let s,o;if(t&&t.className===r&&(!i||t&&t.style.backgroundColor&&T(yn(t.style.backgroundColor),yn(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=At();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const r=be(i),s=jn(i),o=Un(i),a=Zn(i);Ot(e.coordinateToPixelTransform,r),Ot(e.coordinateToPixelTransform,s),Ot(e.coordinateToPixelTransform,o),Ot(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Ot(l,r),Ot(l,s),Ot(l,o),Ot(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){const i=t.extent,r=t.viewState.resolution,s=t.viewState.rotation,o=t.pixelRatio,a=Math.round(Q(i)/r*o),l=Math.round(Rt(i)/r*o);Ve(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,s,-a/2,-l/2),zi(this.inversePixelTransform,this.pixelTransform);const h=function ds(n){return"matrix("+n.map((e,i)=>Math.round(e*us[i])/us[i]).join(", ")+")"}(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){const s=new Co(t,this.inversePixelTransform,i,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_("postrender",t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new nu),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_("prerender",this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_("postrender",this.context,t))}getRenderTransform(t,e,i,r,s,o,a){const c=r/e;return Ve(this.tempTransform,s/2,o/2,c,-c,-i,-t[0]+a,-t[1])}disposeInternal(){delete this.frameState,super.disposeInternal()}},Po=class ou extends qt{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent("change")}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){K()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const r=e-i+1e3/60;return r>=this.transition_?1:cs(r/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},So=class au extends Po{constructor(t,e,i,r,s,o){super(t,e,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function lu(){const n=At(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;this.state=t.naturalWidth&&t.naturalHeight?2:4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=function Zl(n,t,e){const i=n;let r=!0,s=!1,o=!1;const a=[Gt(i,"load",function(){o=!0,s||t()})];return i.src&&Us?(s=!0,i.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(Gt(i,"error",e)),function(){r=!1,a.forEach(et)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}},du=class uu{constructor(t,e,i,r,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=fn(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const A=w[0]+"/"+w[1];return a[A]||(a[A]=l(w)),a[A]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Q(r)>=Q(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Q(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Q(this.targetProj_.getExtent()):null;const h=be(i),c=jn(i),u=Un(i),d=Zn(i),f=this.transformInv_(h),g=this.transformInv_(c),p=this.transformInv_(u),v=this.transformInv_(d),C=10+(o?Math.max(0,Math.ceil(Math.log2(Yn(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,g,p,v,C),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(A,I,R){w=Math.min(w,A.source[0][0],A.source[1][0],A.source[2][0])}),this.triangles_.forEach(A=>{if(Math.max(A.source[0][0],A.source[1][0],A.source[2][0])-w>this.sourceWorldWidth_/2){const I=[[A.source[0][0],A.source[0][1]],[A.source[1][0],A.source[1][1]],[A.source[2][0],A.source[2][1]]];I[0][0]-w>this.sourceWorldWidth_/2&&(I[0][0]-=this.sourceWorldWidth_),I[1][0]-w>this.sourceWorldWidth_/2&&(I[1][0]-=this.sourceWorldWidth_),I[2][0]-w>this.sourceWorldWidth_/2&&(I[2][0]-=this.sourceWorldWidth_);const R=Math.min(I[0][0],I[1][0],I[2][0]);Math.max(I[0][0],I[1][0],I[2][0])-R<this.sourceWorldWidth_/2&&(A.source=I)}})}a={}}addTriangle_(t,e,i,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,i]})}addQuad_(t,e,i,r,s,o,a,l,h){const c=jr([s,o,a,l]),u=this.sourceWorldWidth_?Q(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(g=Q(jr([t,e,i,r]))/this.targetWorldWidth_>.25||g),!f&&this.sourceProj_.isGlobal()&&u&&(g=u>.25||g)),!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!cn(c,this.maxSourceExtent_))return;let p=0;if(!(g||isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1])))if(h>0)g=!0;else if(p=(isFinite(s[0])&&isFinite(s[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),1!=p&&2!=p&&4!=p&&8!=p)return;if(h>0){if(!g){const C=this.transformInv_([(t[0]+i[0])/2,(t[1]+i[1])/2]);let w;w=f?(Ie(s[0],d)+Ie(a[0],d))/2-Ie(C[0],d):(s[0]+a[0])/2-C[0];const A=(s[1]+a[1])/2-C[1];g=w*w+A*A>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const v=[(e[0]+i[0])/2,(e[1]+i[1])/2],C=this.transformInv_(v),w=[(r[0]+t[0])/2,(r[1]+t[1])/2],A=this.transformInv_(w);this.addQuad_(t,e,v,w,s,o,C,A,h-1),this.addQuad_(w,v,i,r,A,C,a,l,h-1)}else{const v=[(t[0]+e[0])/2,(t[1]+e[1])/2],C=this.transformInv_(v),w=[(i[0]+r[0])/2,(i[1]+r[1])/2],A=this.transformInv_(w);this.addQuad_(t,v,w,r,s,C,A,l,h-1),this.addQuad_(v,e,i,w,C,o,a,A,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&p||this.addTriangle_(t,i,r,s,a,l),14&p||this.addTriangle_(t,i,e,s,a,o),p&&(13&p||this.addTriangle_(e,r,t,o,l,s),7&p||this.addTriangle_(e,r,i,o,l,a))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,i,r){const s=e.source;hn(t,s[0]),hn(t,s[1]),hn(t,s[2])}),t}getTriangles(){return this.triangles_}};let br;const Qe=[];function Do(n,t,e,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),n.restore()}function Lr(n,t){return Math.abs(n[4*t]-210)>2||Math.abs(n[4*t+3]-191.25)>2}function Fo(n,t,e,i){const r=gn(e,t,n);let s=ns(t,i,e);const o=t.getMetersPerUnit();void 0!==o&&(s*=o);const a=n.getMetersPerUnit();void 0!==a&&(s/=a);const l=n.getExtent();if(!l||wi(l,r)){const h=ns(n,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}const Pr=class mu extends Po{constructor(t,e,i,r,s,o,a,l,h,c,u,d){super(s,0,d),this.renderEdges_=void 0!==u&&u,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const f=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const v=g?Ue(f,g):f;if(0===Yn(v))return void(this.state=4);const C=t.getExtent();C&&(p=p?Ue(p,C):C);const w=r.getResolution(this.wrappedTileCoord_[0]),A=function gu(n,t,e,i){const r=Ze(e);let s=Fo(n,t,r,i);return(!isFinite(s)||s<=0)&&Hr(e,function(o){return s=Fo(n,t,o,i),isFinite(s)&&s>0}),s}(t,i,v,w);if(!isFinite(A)||A<=0)return void(this.state=4);if(this.triangulation_=new du(t,i,v,p,A*(void 0!==c?c:.5),w),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=e.getZForResolution(A);let R=this.triangulation_.calculateSourceExtent();if(p&&(t.canWrapX()?(R[1]=at(R[1],p[1],p[3]),R[3]=at(R[3],p[1],p[3])):R=Ue(R,p)),Yn(R)){let z=0,F=0;t.canWrapX()&&(z=Q(C),F=Math.floor((R[0]-C[0])/z)),function Oa(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];!function Sa(n,t){const e=t.getExtent(),i=Ze(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const r=Q(e),o=Math.floor((i[0]-e[0])/r)*r;n[0]-=o,n[2]-=o}}(n,t);const r=Q(i);if(Q(n)>r&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}(R.slice(),t,!0).forEach(N=>{const rt=e.getTileRangeForExtentAndZ(N,this.sourceZ_);for(let pt=rt.minX;pt<=rt.maxX;pt++)for(let ct=rt.minY;ct<=rt.maxY;ct++){const yt=h(this.sourceZ_,pt,ct,a);yt&&this.sourceTiles_.push({tile:yt,offset:F*z})}++F}),0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const i=e.tile;if(i&&2==i.getState()){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=e.offset,r[2]+=e.offset;const s=this.clipExtent_?.slice();s&&(s[0]+=e.offset,s[2]+=e.offset),t.push({extent:r,clipExtent:s,image:i.getImage()})}}),this.sourceTiles_.length=0,0===t.length)this.state=3;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r="number"==typeof i?i:i[0],s="number"==typeof i?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function _u(n,t,e,i,r,s,o,a,l,h,c,u,d,f){const g=At(Math.round(e*n),Math.round(e*t),Qe);if(u||(g.imageSmoothingEnabled=!1),0===l.length)return g.canvas;function p(R){return Math.round(R*e)/e}g.scale(e,e),g.globalCompositeOperation="lighter";const v=[1/0,1/0,-1/0,-1/0];let C;l.forEach(function(R,z,F){!function Ia(n,t){t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3])}(v,R.extent)});const w=e/i,A=(u?1:1+Math.pow(2,-24))/w;if(!d||1!==l.length||0!==h){if(C=At(Math.round(Q(v)*w),Math.round(Rt(v)*w),Qe),u||(C.imageSmoothingEnabled=!1),r&&f){const R=(r[0]-v[0])*w,z=-(r[3]-v[3])*w,F=Q(r)*w,O=Rt(r)*w;C.rect(R,z,F,O),C.clip()}l.forEach(function(R,z,F){if(R.image.width>0&&R.image.height>0){if(R.clipExtent){C.save();const ct=(R.clipExtent[0]-v[0])*w,yt=-(R.clipExtent[3]-v[3])*w,Dt=Q(R.clipExtent)*w,Wt=Rt(R.clipExtent)*w;C.rect(u?ct:Math.round(ct),u?yt:Math.round(yt),u?Dt:Math.round(ct+Dt)-Math.round(ct),u?Wt:Math.round(yt+Wt)-Math.round(yt)),C.clip()}const O=(R.extent[0]-v[0])*w,N=-(R.extent[3]-v[3])*w,rt=Q(R.extent)*w,pt=Rt(R.extent)*w;C.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,u?O:Math.round(O),u?N:Math.round(N),u?rt:Math.round(O+rt)-Math.round(O),u?pt:Math.round(N+pt)-Math.round(N)),R.clipExtent&&C.restore()}})}const I=be(o);return a.getTriangles().forEach(function(R,z,F){const O=R.source,N=R.target;let rt=O[0][0],pt=O[0][1],ct=O[1][0],yt=O[1][1],Dt=O[2][0],Wt=O[2][1];const tt=p((N[0][0]-I[0])/s),Kt=p(-(N[0][1]-I[1])/s),Lt=p((N[1][0]-I[0])/s),te=p(-(N[1][1]-I[1])/s),Mt=p((N[2][0]-I[0])/s),Ft=p(-(N[2][1]-I[1])/s),ut=rt,dt=pt;rt=0,pt=0,ct-=ut,yt-=dt,Dt-=ut,Wt-=dt;const Vt=function sa(n){const t=n.length;for(let i=0;i<t;i++){let r=i,s=Math.abs(n[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(n[a][i]);l>s&&(s=l,r=a)}if(0===s)return null;const o=n[r];n[r]=n[i],n[i]=o;for(let a=i+1;a<t;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<t+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let r=i-1;r>=0;r--)n[r][t]-=n[r][i]*e[i]}return e}([[ct,yt,0,0,Lt-tt],[Dt,Wt,0,0,Mt-tt],[0,0,ct,yt,te-Kt],[0,0,Dt,Wt,Ft-Kt]]);if(!Vt)return;if(g.save(),g.beginPath(),function fu(){if(void 0===br){const n=At(6,6,Qe);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Do(n,4,5,4,0),Do(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;br=Lr(t,0)||Lr(t,4)||Lr(t,8),nr(n),Qe.push(n.canvas)}return br}()||!u){g.moveTo(Lt,te);const Et=4,ce=tt-Lt,Pn=Kt-te;for(let kt=0;kt<Et;kt++)g.lineTo(Lt+p((kt+1)*ce/Et),te+p(kt*Pn/(Et-1))),kt!=Et-1&&g.lineTo(Lt+p((kt+1)*ce/Et),te+p((kt+1)*Pn/(Et-1)));g.lineTo(Mt,Ft)}else g.moveTo(Lt,te),g.lineTo(tt,Kt),g.lineTo(Mt,Ft);let Nt;if(g.clip(),g.transform(Vt[0],Vt[2],Vt[1],Vt[3],tt,Kt),g.translate(v[0]-ut,v[3]-dt),C)Nt=C.canvas,g.scale(A,-A);else{const Et=l[0],ce=Et.extent;Nt=Et.image,g.scale(Q(ce)/Nt.width,-Rt(ce)/Nt.height)}g.drawImage(Nt,0,0),g.restore()}),C&&(nr(C),Qe.push(C.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(R,z,F){const O=R.target,N=(O[0][0]-I[0])/s,rt=-(O[0][1]-I[1])/s,pt=(O[1][0]-I[0])/s,ct=-(O[1][1]-I[1])/s,yt=(O[2][0]-I[0])/s,Dt=-(O[2][1]-I[1])/s;g.beginPath(),g.moveTo(pt,ct),g.lineTo(N,rt),g.lineTo(yt,Dt),g.closePath(),g.stroke()}),g.restore()),g.canvas}(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(0==i||1==i){t++;const r=Y(e,"change",function(s){const o=e.getState();(2==o||3==o||4==o)&&(et(r),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,r){0==e.getState()&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(et),this.sourcesListenerKeys_=null}release(){this.canvas_&&(nr(this.canvas_.getContext("2d")),Qe.push(this.canvas_),this.canvas_=null),super.release()}};class No{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function tn(n,t,e,i,r){return void 0!==r?(r.minX=n,r.maxX=t,r.minY=e,r.maxY=i,r):new No(n,t,e,i)}const ko=No,yu=class pu extends su{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedProjection=null,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new ko(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!r}getTile(t,e,i,r){const s=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(t,e,i,s,o);return 3==h.getState()&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Ot(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!wi(s,r))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(r,d),g=h.getTile(d,f[1],f[2],o,a);if(!(g instanceof So||g instanceof Pr)||g instanceof Pr&&4===g.getState())return null;if(2!==g.getState())continue;const p=c.getOrigin(d),v=xt(c.getTileSize(d)),C=c.getResolution(d),w=Math.floor(u*((r[0]-p[0])/C-f[1]*v[0])),A=Math.floor(u*((p[1]-r[1])/C-f[2]*v[1])),I=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),w+I,A+I)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],r=t.viewState,s=r.projection,o=r.resolution,a=r.center,l=r.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(s),g=f.getZForResolution(o,u.zDirection),p=f.getResolution(g);let v=t.extent;const C=t.viewState.resolution,w=u.getTilePixelRatio(h);this.prepareContainer(t,e);const A=this.context.canvas.width,I=this.context.canvas.height,R=i.extent&&We(i.extent);R&&(v=Ue(v,We(i.extent)));const z=p*A/2/w,F=p*I/2/w,O=[a[0]-z,a[1]-F,a[0]+z,a[1]+F],N=f.getTileRangeForExtentAndZ(v,g),rt={};rt[g]={};const pt=this.createLoadedTileFinder(u,s,rt),ct=this.tmpExtent,yt=this.tmpTileRange_;this.newTiles_=!1;const Dt=l?Ri(r.center,C,l,t.size):void 0;for(let Ft=N.minX;Ft<=N.maxX;++Ft)for(let ut=N.minY;ut<=N.maxY;++ut){if(l&&!f.tileCoordIntersectsViewport([g,Ft,ut],Dt))continue;const dt=this.getTile(g,Ft,ut,t);if(this.isDrawableTile(dt)){const Nt=vt(this);if(2==dt.getState()){rt[g][dt.tileCoord.toString()]=dt;let Et=dt.inTransition(Nt);Et&&1!==i.opacity&&(dt.endTransition(Nt),Et=!1),!this.newTiles_&&(Et||!this.renderedTiles.includes(dt))&&(this.newTiles_=!0)}if(1===dt.getAlpha(Nt,t.time))continue}const Ln=f.getTileCoordChildTileRange(dt.tileCoord,yt,ct);let Vt=!1;Ln&&(Vt=pt(g+1,Ln)),Vt||f.forEachTileCoordParentTileRange(dt.tileCoord,pt,yt,ct)}const Wt=p/o*h/w,tt=this.getRenderContext(t);Ve(this.tempTransform,A/2,I/2,Wt,Wt,0,-A/2,-I/2),R&&this.clipUnrotated(tt,t,R),u.getInterpolate()||(tt.imageSmoothingEnabled=!1),this.preRender(tt,t),this.renderedTiles.length=0;let Lt,te,Mt,Kt=Object.keys(rt).map(Number);Kt.sort(ne),1!==i.opacity||this.containerReused&&!u.getOpaque(t.viewState.projection)?(Lt=[],te=[]):Kt=Kt.reverse();for(let Ft=Kt.length-1;Ft>=0;--Ft){const ut=Kt[Ft],dt=u.getTilePixelSize(ut,h,s),Vt=f.getResolution(ut)/p,Nt=dt[0]*Vt*Wt,Et=dt[1]*Vt*Wt,ce=f.getTileCoordForCoordAndZ(be(O),ut),Pn=f.getTileCoordExtent(ce),kt=Ot(this.tempTransform,[w*(Pn[0]-O[0])/p,w*(O[3]-Pn[3])/p]),cd=w*u.getGutterForProjection(s),qo=rt[ut];for(const ud in qo){const nn=qo[ud],Ho=nn.tileCoord,$o=ce[1]-Ho[1],dd=Math.round(kt[0]-($o-1)*Nt),Jo=ce[2]-Ho[2],fd=Math.round(kt[1]-(Jo-1)*Et),ue=Math.round(kt[0]-$o*Nt),de=Math.round(kt[1]-Jo*Et),Sn=dd-ue,On=fd-de,Qo=g===ut,ta=Qo&&1!==nn.getAlpha(vt(this),t.time);let Fr=!1;if(!ta)if(Lt){Mt=[ue,de,ue+Sn,de,ue+Sn,de+On,ue,de+On];for(let _i=0,gd=Lt.length;_i<gd;++_i)if(g!==ut&&ut<te[_i]){const zt=Lt[_i];cn([ue,de,ue+Sn,de+On],[zt[0],zt[3],zt[4],zt[7]])&&(Fr||(tt.save(),Fr=!0),tt.beginPath(),tt.moveTo(Mt[0],Mt[1]),tt.lineTo(Mt[2],Mt[3]),tt.lineTo(Mt[4],Mt[5]),tt.lineTo(Mt[6],Mt[7]),tt.moveTo(zt[6],zt[7]),tt.lineTo(zt[4],zt[5]),tt.lineTo(zt[2],zt[3]),tt.lineTo(zt[0],zt[1]),tt.clip())}Lt.push(Mt),te.push(ut)}else tt.clearRect(ue,de,Sn,On);this.drawTileImage(nn,t,ue,de,Sn,On,cd,Qo),Lt&&!ta?(Fr&&tt.restore(),this.renderedTiles.unshift(nn)):this.renderedTiles.push(nn),this.updateUsedTiles(t.usedTiles,u,nn)}}return this.renderedRevision=d,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!Ci(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,u,f,h,s,v,g,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(this.context,t),i.extent&&tt.restore(),tt.imageSmoothingEnabled=!0,this.container}drawTileImage(t,e,i,r,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=vt(this),d=e.layerStatesArray[e.layerIndex],f=d.opacity*(l?t.getAlpha(u,e.time):1),g=f!==c.globalAlpha;g&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,r,s,o),g&&c.restore(),f!==d.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(r,s,o){const a=vt(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const r=vt(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}manageTilePyramid(t,e,i,r,s,o,a,l,h){const c=vt(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue,f=i.getMinZoom(),g=t.viewState.rotation,p=g?Ri(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let C,w,A,I,R,z,v=0;for(z=f;z<=a;++z)for(w=i.getTileRangeForExtentAndZ(o,z,w),A=i.getResolution(z),I=w.minX;I<=w.maxX;++I)for(R=w.minY;R<=w.maxY;++R)g&&!i.tileCoordIntersectsViewport([z,I,R],p)||(a-z<=l?(++v,C=e.getTile(z,I,R,r,s),0==C.getState()&&(u[C.getKey()]=!0,d.isKeyQueued(C.getKey())||d.enqueue([C,c,i.getTileCoordCenter(C.tileCoord),A])),void 0!==h&&h(C)):e.useTile(z,I,R,s));e.updateCacheSize(v,s)}},zo=class Eu extends Jc{constructor(t){super(t)}createRenderer(){return new yu(this)}},wu=class vu{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return H(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return H(void 0!==e,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){H(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};function Go(n,t,e,i){return void 0!==i?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function bn(n,t,e){return n+"/"+t+"/"+e}function Xo(n){return bn(n[0],n[1],n[2])}const Yo=class Iu extends wu{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const i=function Cu(n){return n.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(r=>{r.tileCoord[0]!==i&&(this.remove(Xo(r.tileCoord)),r.release())})}};function Zo(n){return n?Array.isArray(n)?function(t){return n}:"function"==typeof n?n:function(t){return[n]}:null}const xu=class Mu extends re{constructor(t){super(),this.projection=ft(t.projection),this.attributions_=Zo(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Zo(t),this.changed()}setState(t){this.state_=t,this.changed()}},en=[0,0,0],Uo=class Au{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,H(function x(n,t,e){const i=t||ne;return n.every(function(r,s){if(0===s)return!0;const o=i(n[s-1],r);return!(o>0||e&&0===o)})}(this.resolutions_,(r,s)=>s-r,!0),"`resolutions` must be sorted in descending order"),!t.origins)for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(e){if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}else e=this.resolutions_[r]/this.resolutions_[r+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,H(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;void 0!==i&&!this.origin_&&!this.origins_&&(this.origin_=be(i)),H(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,H(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:vi,H(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new ko(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)i([e,s,a])}forEachTileCoordParentTileRange(t,e,i,r){let s,o,a,l=null,h=t[0]-1;for(2===this.zoomFactor_?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(void 0!==o&&void 0!==a?(o=Math.floor(o/2),a=Math.floor(a/2),s=tn(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const s=2*t[1],o=2*t[2];return tn(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return tn(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(s*l),c=Math.floor(o*l);return e<r?tn(h,h,c,c,i):tn(h,Math.floor(l*(s+1))-1,c,Math.floor(l*(o+1))-1,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,en);const r=en[1],s=en[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,en),tn(r,en[1],s,en[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=xt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=xt(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*s[0]*r,a=i[1]-(t[2]+1)*s[1]*r;return Ye(o,a,o+s[0]*r,a+s[1]*r,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=xt(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],u=a*(l[1]-e)/i/h[1];return r?(c=kn(c,5)-1,u=kn(u,5)-1):(c=Nn(c,5),u=Nn(u,5)),Go(o,c,u,s)}getTileCoordForXYAndZ_(t,e,i,r,s){const o=this.getOrigin(i),a=this.getResolution(i),l=xt(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return r?(h=kn(h,5)-1,c=kn(c,5)-1):(h=Nn(h,5),c=Nn(c,5)),Go(i,h,c,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return at(Bt(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return bs(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}};function jo(n){let t=n.getDefaultTileGrid();return t||(t=function Su(n,t,e,i){return function Lu(n,t,e,i){i=void 0!==i?i:"top-left";const r=Wo(n,t,e);return new Uo({extent:n,origin:Aa(n,i),resolutions:r,tileSize:e})}(Or(n),t,e,i)}(n),n.setDefaultTileGrid(t)),t}function Wo(n,t,e,i){t=void 0!==t?t:la,e=xt(void 0!==e?e:vi);const r=Rt(n),s=Q(n);i=i>0?i:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Or(n){let t=(n=ft(n)).getExtent();if(!t){const e=180*an.degrees/n.getMetersPerUnit();t=Ye(-e,-e,e,e)}return t}class Du extends Ct{constructor(t,e){super(t),this.tile=e}}const Fu=class Ou extends xu{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.tileGrid&&xt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new Yo(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,r){const s=this.getTileCacheForProjection(t);if(!s)return!1;let a,l,h,o=!0;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=bn(e,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=2===a.getState(),h&&(h=!1!==r(a))),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,s){return K()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:jo(t)}getTileCacheForProjection(t){const e=this.getProjection();return H(null===e||je(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),o=xt(r.getTileSize(t),this.tmpSize);return 1==s?o:function Al(n,t,e){return void 0===e&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function bu(n,t,e){const i=t[0],r=n.getTileCoordCenter(t),s=Or(e);if(!wi(s,r)){const o=Q(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,n.getTileCoordForCoordAndZ(r,i)}return t}(i,t,e)),function Ru(n,t){const e=n[0],i=n[1],r=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return!s||s.containsXY(i,r)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,r){}};function Nu(n,t){const e=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return n.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const c=t.getFullTileRange(o[0]);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}class Dr extends Fu{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Dr.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=vt(e),r=e.getState();let s;1==r?(this.tileLoadingKeys_[i]=!0,s="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=3==r?"tileloaderror":2==r?"tileloadend":void 0),null!=s&&this.dispatchEvent(new Du(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=function Gu(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=i;s<=r;++s)t.push(n.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(n.replace(e[0],r.toString()));return t}return t.push(n),t}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function ku(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=Nu(n[r],t);return function zu(n){return 1===n.length?n[0]:function(t,e,i){if(!t)return;const r=function Tu(n){return(n[1]<<n[0])+n[2]}(t),s=Ie(r,n.length);return n[s](t,e,i)}}(i)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const r=bn(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const Xu=Dr;function Zu(n,t){n.getImage().src=t}const Uu=class Yu extends Xu{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Zu,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:So,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!je(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!je(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||je(e,t)))return this.tileGrid;const i=vt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=jo(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||je(e,t))return this.tileCache;const i=vt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Yo(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,r,s,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,void 0!==h?0:4,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener("change",this.handleTileChange.bind(this)),c}getTile(t,e,i,r,s){const o=this.getProjection();if(!o||!s||je(o,s))return this.getTileInternal(t,e,i,r,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,i];let h;const c=Xo(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(s),g=this.getTileCoordForTileUrlFunction(l,s),p=new Pr(o,d,s,f,l,g,this.getTilePixelRatio(r),this.getGutter(),(v,C,w,A)=>this.getTileInternal(v,C,w,A,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return p.key=u,h?(p.interimTile=h,p.refreshInterimChain(),a.replace(c,p)):a.set(c,p),p}getTileInternal(t,e,i,r,s){let o=null;const a=bn(t,e,i),l=this.getKey();if(this.tileCache.containsKey(a)){if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,r,s,l),o.interimTile=0==h.getState()?h.interimTile:h,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,i,r,s,l),this.tileCache.set(a,o);return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=ft(t);if(i){const r=vt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Ko=class ju extends Uu{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:function Pu(n){const t=n||{},e=t.extent||ft("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Wo(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Uo(i)}({extent:Or(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}};var E=ot(5849),Wu=ot(9862);let Vo=(()=>{class n{constructor(e){this.http=e,this.baseUrl="http://127.0.0.1:8093/api/layers/sentinel"}getSentinelLayer(e,i,r,s,o,a,l){let h={};return void 0!==a&&(h.latitude=a),void 0!==l&&(h.longitude=l),this.http.get(`${this.baseUrl}/${e}/${i}/${r}/${s}/${o}`,{params:h})}static#t=this.\u0275fac=function(i){return new(i||n)(E.LFG(Wu.eN))};static#e=this.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Bo=ot(1735);function Ku(n,t){if(1&n&&(E.TgZ(0,"div",2),E._UZ(1,"div",3),E.qZA()),2&n){const e=t.$implicit;E.xp6(1),E.Q6J("id",e.id)}}let Vu=(()=>{class n{constructor(e,i){this.layerService=e,this.pointService=i,this.periods=["WET","DRY"],this.years=[2017,2018,2019,2020,2021,2022,2023],this.months=["02","09"],this.maps=[],this.centerCoordinates=qn([-57.149819,-21.329828]),this.mapsInstances=[]}ngOnInit(){this.initializeMaps(),this.pointService.point$.subscribe({next:e=>{e.lat&&e.lon&&this.updateCenterCoordinates([e.lon,e.lat])}})}initializeMaps(){for(let e of this.years)for(let i of this.months){let r="02"===i?"WET":"DRY",s=`map-${r}-${e}`;this.maps.push({period:r,year:e,id:s}),this.createMap(s,r,e)}}createMap(e,i,r){setTimeout(()=>{const s=new Lo({target:e,layers:[new zo({source:new Ko({url:`https://tm{1-5}.lapig.iesa.ufg.br/api/layers/s2_harmonized/${i}/${r}/{x}/{y}/{z}`,attributions:`${i} - ${r}`,attributionsCollapsible:!1})})],view:new Zt({center:this.centerCoordinates,zoom:13}),interactions:Ar().extend([new Fe({handleDownEvent:o=>{const a=ss(o.coordinate);return this.updateCenterCoordinates(a),!0}})])});this.mapsInstances.push(s)},0)}updateCenterCoordinates(e){this.centerCoordinates=qn(e),this.updateMaps()}updateMaps(){for(let e of this.mapsInstances)e.getView().setCenter(this.centerCoordinates)}static#t=this.\u0275fac=function(i){return new(i||n)(E.Y36(Vo),E.Y36(Bo.H))};static#e=this.\u0275cmp=E.Xpm({type:n,selectors:[["app-map-grid"]],decls:2,vars:1,consts:[[1,"map-grid"],["class","map-item",4,"ngFor","ngForOf"],[1,"map-item"],[1,"map-container",3,"id"]],template:function(i,r){1&i&&(E.TgZ(0,"div",0),E.YNc(1,Ku,2,1,"div",1),E.qZA()),2&i&&(E.xp6(1),E.Q6J("ngForOf",r.maps))},dependencies:[ee.sg],styles:[".map-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.map-item[_ngcontent-%COMP%]{flex:1 1 20%;margin:1px;text-align:center}.map-container[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return n})();var gi=ot(5219);function Bu(n,t){1&n&&E.GkF(0)}function qu(n,t){if(1&n&&(E.TgZ(0,"div",8),E.Hsn(1,1),E.YNc(2,Bu,1,0,"ng-container",6),E.qZA()),2&n){const e=E.oxw();E.xp6(2),E.Q6J("ngTemplateOutlet",e.headerTemplate)}}function Hu(n,t){1&n&&E.GkF(0)}function $u(n,t){if(1&n&&(E.TgZ(0,"div",9),E._uU(1),E.YNc(2,Hu,1,0,"ng-container",6),E.qZA()),2&n){const e=E.oxw();E.xp6(1),E.hij(" ",e.header," "),E.xp6(1),E.Q6J("ngTemplateOutlet",e.titleTemplate)}}function Ju(n,t){1&n&&E.GkF(0)}function Qu(n,t){if(1&n&&(E.TgZ(0,"div",10),E._uU(1),E.YNc(2,Ju,1,0,"ng-container",6),E.qZA()),2&n){const e=E.oxw();E.xp6(1),E.hij(" ",e.subheader," "),E.xp6(1),E.Q6J("ngTemplateOutlet",e.subtitleTemplate)}}function td(n,t){1&n&&E.GkF(0)}function ed(n,t){1&n&&E.GkF(0)}function nd(n,t){if(1&n&&(E.TgZ(0,"div",11),E.Hsn(1,2),E.YNc(2,ed,1,0,"ng-container",6),E.qZA()),2&n){const e=E.oxw();E.xp6(2),E.Q6J("ngTemplateOutlet",e.footerTemplate)}}const id=["*",[["p-header"]],[["p-footer"]]],rd=["*","p-header","p-footer"];let sd=(()=>{class n{el;header;subheader;style;styleClass;headerFacet;footerFacet;templates;headerTemplate;titleTemplate;subtitleTemplate;contentTemplate;footerTemplate;constructor(e){this.el=e}ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"header":this.headerTemplate=e.template;break;case"title":this.titleTemplate=e.template;break;case"subtitle":this.subtitleTemplate=e.template;break;case"content":default:this.contentTemplate=e.template;break;case"footer":this.footerTemplate=e.template}})}getBlockableElement(){return this.el.nativeElement.children[0]}static \u0275fac=function(i){return new(i||n)(E.Y36(E.SBq))};static \u0275cmp=E.Xpm({type:n,selectors:[["p-card"]],contentQueries:function(i,r,s){if(1&i&&(E.Suo(s,gi.h4,5),E.Suo(s,gi.$_,5),E.Suo(s,gi.jx,4)),2&i){let o;E.iGM(o=E.CRH())&&(r.headerFacet=o.first),E.iGM(o=E.CRH())&&(r.footerFacet=o.first),E.iGM(o=E.CRH())&&(r.templates=o)}},hostAttrs:[1,"p-element"],inputs:{header:"header",subheader:"subheader",style:"style",styleClass:"styleClass"},ngContentSelectors:rd,decls:9,vars:10,consts:[[3,"ngClass","ngStyle"],["class","p-card-header",4,"ngIf"],[1,"p-card-body"],["class","p-card-title",4,"ngIf"],["class","p-card-subtitle",4,"ngIf"],[1,"p-card-content"],[4,"ngTemplateOutlet"],["class","p-card-footer",4,"ngIf"],[1,"p-card-header"],[1,"p-card-title"],[1,"p-card-subtitle"],[1,"p-card-footer"]],template:function(i,r){1&i&&(E.F$t(id),E.TgZ(0,"div",0),E.YNc(1,qu,3,1,"div",1),E.TgZ(2,"div",2),E.YNc(3,$u,3,2,"div",3)(4,Qu,3,2,"div",4),E.TgZ(5,"div",5),E.Hsn(6),E.YNc(7,td,1,0,"ng-container",6),E.qZA(),E.YNc(8,nd,3,1,"div",7),E.qZA()()),2&i&&(E.Tol(r.styleClass),E.Q6J("ngClass","p-card p-component")("ngStyle",r.style),E.uIk("data-pc-name","card"),E.xp6(1),E.Q6J("ngIf",r.headerFacet||r.headerTemplate),E.xp6(2),E.Q6J("ngIf",r.header||r.titleTemplate),E.xp6(1),E.Q6J("ngIf",r.subheader||r.subtitleTemplate),E.xp6(3),E.Q6J("ngTemplateOutlet",r.contentTemplate),E.xp6(1),E.Q6J("ngIf",r.footerFacet||r.footerTemplate))},dependencies:[ee.mk,ee.O5,ee.tP,ee.PC],styles:["@layer primeng{.p-card-header img{width:100%}}\n"],encapsulation:2,changeDetection:0})}return n})(),od=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=E.oAB({type:n});static \u0275inj=E.cJS({imports:[ee.ez,gi.m8]})}return n})(),ad=(()=>{class n{constructor(e,i){this.layerService=e,this.pointService=i,this.periods=["WET","DRY"],this.years=[2017,2018,2019,2020,2021,2022,2023],this.months=["02","09"],this.maps=[],this.centerCoordinates=qn([-57.149819,-21.329828]),this.mapsInstances=[]}ngOnInit(){this.initializeMaps(),this.pointService.point$.subscribe({next:e=>{e.lat&&e.lon&&this.updateCenterCoordinates([e.lon,e.lat])}})}initializeMaps(){for(let e of this.years)for(let i of this.months){let r="02"===i?"WET":"DRY",s=`map-${r}-${e}`;this.maps.push({period:r,year:e,id:s}),this.createMap(s,r,e)}}createMap(e,i,r){setTimeout(()=>{const s=new Lo({target:e,layers:[new zo({source:new Ko({url:`https://tm{1-5}.lapig.iesa.ufg.br/api/layers/s2_harmonized/${i}/${r}/{x}/{y}/{z}`,attributions:`${i} - ${r}`,attributionsCollapsible:!1})})],view:new Zt({center:this.centerCoordinates,zoom:13}),interactions:Ar().extend([new Fe({handleDownEvent:o=>{const a=ss(o.coordinate);return this.updateCenterCoordinates(a),!0}})])});this.mapsInstances.push(s)},0)}updateCenterCoordinates(e){this.centerCoordinates=qn(e),this.updateMaps()}updateMaps(){for(let e of this.mapsInstances)e.getView().setCenter(this.centerCoordinates)}static#t=this.\u0275fac=function(i){return new(i||n)(E.Y36(Vo),E.Y36(Bo.H))};static#e=this.\u0275cmp=E.Xpm({type:n,selectors:[["app-map-grid"]],decls:7,vars:0,consts:[[1,"text-center"]],template:function(i,r){1&i&&(E.TgZ(0,"p-card")(1,"h1",0),E._uU(2,"Sentinel 2 Images"),E.qZA(),E.TgZ(3,"p"),E._uU(4,"This component displays multiple map instances based on different periods and years."),E.qZA(),E.TgZ(5,"p"),E._uU(6," The Map Grid Component initializes multiple maps for the specified periods (WET and DRY) and years (2017 to 2023). It uses OpenLayers to render map tiles from a remote server. Users can interact with the maps to update center coordinates. "),E.qZA()())},dependencies:[sd],encapsulation:2})}return n})(),ld=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=E.oAB({type:n});static#n=this.\u0275inj=E.cJS({imports:[$.Bz.forChild([{path:"",data:{breadcrumb:"Maps"},component:ad},{path:"sentinel",data:{breadcrumb:"Maps"},component:Vu},{path:"**",redirectTo:"/notfound"}]),$.Bz]})}return n})(),hd=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=E.oAB({type:n});static#n=this.\u0275inj=E.cJS({imports:[ee.ez,ld,od]})}return n})()},1414:function(Nr){Nr.exports=function(){"use strict";function rn(_,m,T,b,x){!function M(P,G,U,j,J){for(;j>U;){if(j-U>600){var V=j-U+1,st=G-U+1,qt=Math.log(V),D=.5*Math.exp(2*qt/3),Y=.5*Math.sqrt(qt*D*(V-D)/V)*(st-V/2<0?-1:1);M(P,G,Math.max(U,Math.floor(G-st*D/V+Y)),Math.min(j,Math.floor(G+(V-st)*D/V+Y)),J)}var ie=P[G],Re=U,Tt=j;for(ot(P,U,G),J(P[j],ie)>0&&ot(P,U,j);Re<Tt;){for(ot(P,Re,Tt),Re++,Tt--;J(P[Re],ie)<0;)Re++;for(;J(P[Tt],ie)>0;)Tt--}0===J(P[U],ie)?ot(P,U,Tt):ot(P,++Tt,j),Tt<=G&&(U=Tt+1),G<=Tt&&(j=Tt-1)}}(_,m,T||0,b||_.length-1,x||ee)}function ot(_,m,T){var b=_[m];_[m]=_[T],_[T]=b}function ee(_,m){return _<m?-1:_>m?1:0}var $=function(_){void 0===_&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function mi(_,m,T){if(!T)return m.indexOf(_);for(var b=0;b<m.length;b++)if(T(_,m[b]))return b;return-1}function we(_,m){ke(_,0,_.children.length,m,_)}function ke(_,m,T,b,x){x||(x=Bt(null)),x.minX=1/0,x.minY=1/0,x.maxX=-1/0,x.maxY=-1/0;for(var M=m;M<T;M++){var P=_.children[M];Ct(x,_.leaf?b(P):P)}return x}function Ct(_,m){return _.minX=Math.min(_.minX,m.minX),_.minY=Math.min(_.minY,m.minY),_.maxX=Math.max(_.maxX,m.maxX),_.maxY=Math.max(_.maxY,m.maxY),_}function Ce(_,m){return _.minX-m.minX}function pi(_,m){return _.minY-m.minY}function Te(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function sn(_){return _.maxX-_.minX+(_.maxY-_.minY)}function ne(_,m){return _.minX<=m.minX&&_.minY<=m.minY&&m.maxX<=_.maxX&&m.maxY<=_.maxY}function on(_,m){return m.minX<=_.maxX&&m.minY<=_.maxY&&m.maxX>=_.minX&&m.maxY>=_.minY}function Bt(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function yi(_,m,T,b,x){for(var M=[m,T];M.length;)if(!((T=M.pop())-(m=M.pop())<=b)){var P=m+Math.ceil((T-m)/b/2)*b;rn(_,P,m,T,x),M.push(m,P,P,T)}}return $.prototype.all=function(){return this._all(this.data,[])},$.prototype.search=function(_){var m=this.data,T=[];if(!on(_,m))return T;for(var b=this.toBBox,x=[];m;){for(var M=0;M<m.children.length;M++){var P=m.children[M],G=m.leaf?b(P):P;on(_,G)&&(m.leaf?T.push(P):ne(_,G)?this._all(P,T):x.push(P))}m=x.pop()}return T},$.prototype.collides=function(_){var m=this.data;if(!on(_,m))return!1;for(var T=[];m;){for(var b=0;b<m.children.length;b++){var x=m.children[b],M=m.leaf?this.toBBox(x):x;if(on(_,M)){if(m.leaf||ne(_,M))return!0;T.push(x)}}m=T.pop()}return!1},$.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var m=0;m<_.length;m++)this.insert(_[m]);return this}var T=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===T.height)this._splitRoot(this.data,T);else{if(this.data.height<T.height){var b=this.data;this.data=T,T=b}this._insert(T,this.data.height-T.height-1,!0)}else this.data=T;return this},$.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},$.prototype.clear=function(){return this.data=Bt([]),this},$.prototype.remove=function(_,m){if(!_)return this;for(var T,b,x,M=this.data,P=this.toBBox(_),G=[],U=[];M||G.length;){if(M||(M=G.pop(),b=G[G.length-1],T=U.pop(),x=!0),M.leaf){var j=mi(_,M.children,m);if(-1!==j)return M.children.splice(j,1),G.push(M),this._condense(G),this}x||M.leaf||!ne(M,P)?b?(T++,M=b.children[T],x=!1):M=null:(G.push(M),U.push(T),T=0,b=M,M=M.children[0])}return this},$.prototype.toBBox=function(_){return _},$.prototype.compareMinX=function(_,m){return _.minX-m.minX},$.prototype.compareMinY=function(_,m){return _.minY-m.minY},$.prototype.toJSON=function(){return this.data},$.prototype.fromJSON=function(_){return this.data=_,this},$.prototype._all=function(_,m){for(var T=[];_;)_.leaf?m.push.apply(m,_.children):T.push.apply(T,_.children),_=T.pop();return m},$.prototype._build=function(_,m,T,b){var x,M=T-m+1,P=this._maxEntries;if(M<=P)return we(x=Bt(_.slice(m,T+1)),this.toBBox),x;b||(b=Math.ceil(Math.log(M)/Math.log(P)),P=Math.ceil(M/Math.pow(P,b-1))),(x=Bt([])).leaf=!1,x.height=b;var G=Math.ceil(M/P),U=G*Math.ceil(Math.sqrt(P));yi(_,m,T,U,this.compareMinX);for(var j=m;j<=T;j+=U){var J=Math.min(j+U-1,T);yi(_,j,J,G,this.compareMinY);for(var V=j;V<=J;V+=G){var st=Math.min(V+G-1,J);x.children.push(this._build(_,V,st,b-1))}}return we(x,this.toBBox),x},$.prototype._chooseSubtree=function(_,m,T,b){for(;b.push(m),!m.leaf&&b.length-1!==T;){for(var x=1/0,M=1/0,P=void 0,G=0;G<m.children.length;G++){var U=m.children[G],j=Te(U),J=(V=_,st=U,(Math.max(st.maxX,V.maxX)-Math.min(st.minX,V.minX))*(Math.max(st.maxY,V.maxY)-Math.min(st.minY,V.minY))-j);J<M?(M=J,x=j<x?j:x,P=U):J===M&&j<x&&(x=j,P=U)}m=P||m.children[0]}var V,st;return m},$.prototype._insert=function(_,m,T){var b=T?_:this.toBBox(_),x=[],M=this._chooseSubtree(b,this.data,m,x);for(M.children.push(_),Ct(M,b);m>=0&&x[m].children.length>this._maxEntries;)this._split(x,m),m--;this._adjustParentBBoxes(b,x,m)},$.prototype._split=function(_,m){var T=_[m],b=T.children.length,x=this._minEntries;this._chooseSplitAxis(T,x,b);var M=this._chooseSplitIndex(T,x,b),P=Bt(T.children.splice(M,T.children.length-M));P.height=T.height,P.leaf=T.leaf,we(T,this.toBBox),we(P,this.toBBox),m?_[m-1].children.push(P):this._splitRoot(T,P)},$.prototype._splitRoot=function(_,m){this.data=Bt([_,m]),this.data.height=_.height+1,this.data.leaf=!1,we(this.data,this.toBBox)},$.prototype._chooseSplitIndex=function(_,m,T){for(var b,x,M,P,G,U,j,J=1/0,V=1/0,st=m;st<=T-m;st++){var qt=ke(_,0,st,this.toBBox),D=ke(_,st,T,this.toBBox),Y=(x=qt,M=D,void 0,void 0,void 0,void 0,P=Math.max(x.minX,M.minX),G=Math.max(x.minY,M.minY),U=Math.min(x.maxX,M.maxX),j=Math.min(x.maxY,M.maxY),Math.max(0,U-P)*Math.max(0,j-G)),Gt=Te(qt)+Te(D);Y<J?(J=Y,b=st,V=Gt<V?Gt:V):Y===J&&Gt<V&&(V=Gt,b=st)}return b||T-m},$.prototype._chooseSplitAxis=function(_,m,T){var b=_.leaf?this.compareMinX:Ce,x=_.leaf?this.compareMinY:pi;this._allDistMargin(_,m,T,b)<this._allDistMargin(_,m,T,x)&&_.children.sort(b)},$.prototype._allDistMargin=function(_,m,T,b){_.children.sort(b);for(var x=this.toBBox,M=ke(_,0,m,x),P=ke(_,T-m,T,x),G=sn(M)+sn(P),U=m;U<T-m;U++){var j=_.children[U];Ct(M,_.leaf?x(j):j),G+=sn(M)}for(var J=T-m-1;J>=m;J--){var V=_.children[J];Ct(P,_.leaf?x(V):V),G+=sn(P)}return G},$.prototype._adjustParentBBoxes=function(_,m,T){for(var b=T;b>=0;b--)Ct(m[b],_)},$.prototype._condense=function(_){for(var m=_.length-1,T=void 0;m>=0;m--)0===_[m].children.length?m>0?(T=_[m-1].children).splice(T.indexOf(_[m]),1):this.clear():we(_[m],this.toBBox)},$}()}}]);